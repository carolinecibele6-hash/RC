<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R&C GOLD VIP</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* --- TEMA GOLD VIP OTIMIZADO --- */
        :root { 
            --bg: #000000; 
            --panel: #111111;
            --primary: #FFD700; /* DOURADO OURO */
            --text: #ffffff;
            --border-dim: #333333;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg); 
            color: var(--text);
            font-family: 'Inter', sans-serif;
            width: 100vw; height: 100vh; overflow: hidden;
            background: radial-gradient(circle at 50% 0%, #151000 0%, #000000 85%);
        }

        .hide { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: var(--bg); }

        /* ESTADO DE FOCO VIP */
        .focused {
            border: 2px solid #fff !important;
            background: var(--primary) !important;
            color: #000 !important;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5) !important;
            z-index: 50;
        }
        
        /* CORREÇÃO: Player focado não deve ter escala se estiver em fullscreen */
        .vid-wrapper.fs-mode.focused {
            transform: none !important;
            border: none !important;
            box-shadow: none !important;
        }
        
        .focused i, .focused span, .focused div { color: #000 !important; }
        .focused input { background: #fff !important; color: #000 !important; }

        /* LOGIN */
        .login-box { 
            width: 400px; max-width: 90%; padding: 40px; 
            background: var(--panel); border: 1px solid var(--border-dim); 
            border-radius: 12px; text-align: center; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .logo-txt { font-size: 38px; font-weight: 900; letter-spacing: -2px; margin-bottom: 20px; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .logo-txt span { color: var(--primary); }
        .inp { width: 100%; padding: 14px; margin: 10px 0; background: #050505; border: 1px solid var(--border-dim); color: var(--primary); text-align: center; border-radius: 6px; font-size: 16px; font-weight: bold; }
        .btn { width: 100%; padding: 16px; margin-top: 25px; background: var(--primary); color: #000; border: none; font-weight: 900; border-radius: 6px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* DASHBOARD CENTRALIZADO */
        #dash-layer { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100vh; width: 100vw; position: relative; 
        }
        .top-info { position: absolute; top: 50px; left: 0; width: 100%; text-align: center; }
        .clock { position: absolute; top: 50px; right: 60px; font-weight: 700; color: #fff; font-size: 32px; text-shadow: 0 2px 5px rgba(0,0,0,1); }

        .dash-grid { 
            display: flex; gap: 40px; margin-bottom: 60px; 
            align-items: center; justify-content: center;
        }
        .smart-card { 
            width: 220px; height: 280px;
            background: linear-gradient(145deg, #181818, #0b0b0b);
            border: 1px solid var(--border-dim);
            border-radius: 16px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.2s; /* Animação suave só no menu */
        }
        .smart-card i { font-size: 60px; margin-bottom: 25px; color: #555; }
        .smart-card span { font-size: 18px; font-weight: 700; color: #ccc; text-transform: uppercase; letter-spacing: 1px; }
        
        /* INFO BAR */
        .account-bar {
            display: flex; align-items: center; justify-content: center;
            background: #0b0b0b; padding: 20px 40px;
            border-radius: 100px; border: 1px solid var(--border-dim);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .acc-item { display: flex; flex-direction: column; align-items: center; padding: 0 40px; position: relative; }
        .acc-item:not(:last-child)::after { content: ''; position: absolute; right: 0; top: 10%; height: 80%; width: 1px; background: #333; }
        .acc-label { font-size: 11px; color: #666; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; letter-spacing: 1px; }
        .acc-val { font-size: 16px; color: #fff; font-weight: 700; }
        .acc-val.highlight { color: var(--primary); }

        /* CONTEÚDO */
        #content-layer { display: flex; height: 100vh; width: 100vw; }
        
        .col-cat { width: 25%; background: #050505; border-right: 1px solid var(--border-dim); display: flex; flex-direction: column; }
        .cat-head { padding: 25px; font-weight: 900; color: var(--primary); font-size: 22px; text-align: center; border-bottom: 1px solid var(--border-dim); background: #000; letter-spacing: 1px; }
        .cat-list { flex: 1; overflow-y: auto; padding-top: 10px; }
        .cat-item { padding: 15px 30px; color: #888; font-size: 15px; font-weight: 600; border-left: 4px solid transparent; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: background 0.1s; }
        .cat-item.active { background: #111; color: #fff; border-left-color: var(--primary); }

        .col-list { width: 30%; background: #0a0a0a; display: flex; flex-direction: column; border-right: 1px solid var(--border-dim); }
        .search-box { padding: 20px; border-bottom: 1px solid var(--border-dim); background: #080808; }
        .inp-search { width: 100%; background: #151515; border: 1px solid #333; padding: 12px; color: #fff; text-align: center; border-radius: 6px; text-transform: uppercase; font-weight: bold; }
        .item-list { flex: 1; overflow-y: auto; }
        .item { padding: 15px 25px; border-bottom: 1px solid #1a1a1a; color: #bbb; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item.playing { color: var(--primary); font-weight: 900; background: #151000; border-left: 3px solid var(--primary); }
        
        /* PLAYER CONTAINER OTIMIZADO */
        .col-play { flex: 1; background: #000; display: flex; flex-direction: column; position: relative; }
        
        .vid-wrapper { 
            width: 100%; height: 50vh; 
            background: #000; position: relative; 
            border-bottom: 2px solid var(--border-dim);
            /* OTIMIZAÇÃO: Animação apenas na borda/cor, não no layout */
            transition: border 0.1s, box-shadow 0.1s; 
            will-change: transform; /* Prepara GPU */
        }
        
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        
        /* CLASSE FULLSCREEN INSTANTÂNEA */
        .vid-wrapper.fs-mode {
            position: fixed !important;
            top: 0 !important; left: 0 !important;
            width: 100vw !important; height: 100vh !important;
            z-index: 99999 !important;
            border: none !important;
            box-shadow: none !important;
            transform: none !important;
            transition: none !important; /* MATA A ANIMAÇÃO DE ZOOM */
            animation: none !important;
        }

        .meta { padding: 40px; flex: 1; background: #080808; display: flex; flex-direction: column; overflow: hidden; }
        .meta-title { font-size: 32px; font-weight: 800; color: #fff; margin-bottom: 10px; line-height: 1.1; }
        .meta-sub { font-size: 16px; color: var(--primary); margin-bottom: 20px; font-weight: bold; }
        .meta-desc { color: #888; font-size: 16px; line-height: 1.6; flex: 1; overflow: hidden; text-align: justify; }
        
        .keys { display: flex; gap: 30px; margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border-dim); }
        .key { font-size: 13px; font-weight: bold; color: #aaa; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .dot { width: 16px; height: 16px; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.8); border: 2px solid rgba(255,255,255,0.1); }

        #osd { position: absolute; top: 30px; right: 30px; background: rgba(0,0,0,0.9); color: var(--primary); padding: 10px 20px; border: 1px solid var(--primary); border-radius: 6px; font-weight: 800; font-size: 16px; display: none; z-index: 100000; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        #loader { background: rgba(0,0,0,0.98); z-index: 20000; flex-direction: column; color: var(--primary); }
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="hide flex-center">
        <i class="fas fa-circle-notch fa-spin" style="font-size:50px; margin-bottom:20px"></i>
        <div style="font-weight:900; letter-spacing:2px; font-size: 18px;">CARREGANDO...</div>
    </div>

    <div id="login-layer" class="layer flex-center">
        <div class="login-box">
            <div class="logo-txt">R&C <span>GOLD</span></div>
            <input type="text" id="i0" class="inp focusable" placeholder="URL DNS" autocomplete="off">
            <input type="text" id="i1" class="inp focusable" placeholder="USUÁRIO" autocomplete="off">
            <input type="password" id="i2" class="inp focusable" placeholder="SENHA" autocomplete="off">
            <button id="i3" class="btn focusable" onclick="App.login()">ENTRAR</button>
            <div id="msg-login" style="color:#ff4444; margin-top:15px; font-size:13px; font-weight:bold;"></div>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="top-info"><div class="logo-txt" style="font-size:50px; margin:0">R&C <span>GOLD</span></div></div>
        <div class="clock" id="clock">12:00</div>
        
        <div class="dash-grid">
            <div id="m0" class="smart-card focusable" onclick="App.openMode('live')"><i class="fas fa-tv"></i><span>TV AO VIVO</span></div>
            <div id="m1" class="smart-card focusable" onclick="App.openMode('movie')"><i class="fas fa-film"></i><span>FILMES</span></div>
            <div id="m2" class="smart-card focusable" onclick="App.openMode('series')"><i class="fas fa-layer-group"></i><span>SÉRIES</span></div>
            <div id="m3" class="smart-card focusable" onclick="App.logout()"><i class="fas fa-power-off" style="color:#ff4444"></i><span>SAIR</span></div>
        </div>
        
        <div class="account-bar">
            <div class="acc-item"><span class="acc-label">USUÁRIO</span><span id="info-user" class="acc-val highlight">...</span></div>
            <div class="acc-item"><span class="acc-label">CRIADO EM</span><span id="info-created" class="acc-val">...</span></div>
            <div class="acc-item"><span class="acc-label">TELAS</span><span id="info-screens" class="acc-val">...</span></div>
            <div class="acc-item"><span class="acc-label">VENCIMENTO</span><span id="info-exp" class="acc-val highlight">...</span></div>
        </div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="col-cat">
            <div class="cat-head">CATEGORIAS</div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="col-list">
            <div class="search-box">
                <input type="text" id="search" class="inp-search focusable" placeholder="BUSCAR..." autocomplete="off">
            </div>
            <div id="item-list" class="item-list"></div>
        </div>
        <div class="col-play">
            <div id="vid-wrapper" class="vid-wrapper focusable">
                <video id="player" playsinline webkit-playsinline></video>
                <div id="osd">BUFFERING...</div>
            </div>
            <div class="meta">
                <div id="meta-title" class="meta-title">R&C GOLD</div>
                <div id="meta-epg" class="meta-sub"></div>
                <div id="meta-desc" class="meta-desc">Selecione um conteúdo para assistir.</div>
                
                <div class="keys">
                    <div class="key"><div class="dot" style="background:#ff4444"></div> TELA CHEIA</div>
                    <div class="key"><div class="dot" style="background:#00C851"></div> TOPO</div>
                    <div class="key"><div class="dot" style="background:#ffbb33"></div> BUSCAR</div>
                    <div class="key"><div class="dot" style="background:#33b5e5"></div> MENU</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var HlsConfig = { enableWorker: true, maxBufferLength: 10, maxMaxBufferLength: 20, backBufferLength: 0, startLevel: -1, manifestLoadingTimeOut: 15000 };

        var Player = {
            hls: null, el: null, url: null,
            init: function() { this.el = document.getElementById('player'); this.el.onerror = () => App.osd("Erro de Reprodução"); },
            reset: function() {
                if(this.hls) { this.hls.destroy(); this.hls = null; }
                this.el.pause(); this.el.removeAttribute('src'); this.el.load();
            },
            play: function(url, isLive) {
                this.reset(); this.url = url;
                if(isLive && url.indexOf('.m3u8')===-1 && url.indexOf('.ts')>-1) url=url.replace('.ts','.m3u8');
                if(Hls.isSupported()) {
                    this.hls = new Hls(HlsConfig); this.hls.loadSource(url); this.hls.attachMedia(this.el);
                    this.hls.on(Hls.Events.MANIFEST_PARSED, ()=>{this.el.play().catch(e=>{})});
                    this.hls.on(Hls.Events.ERROR, (e,d)=>{ if(d.fatal) { if(d.type===Hls.ErrorTypes.NETWORK_ERROR) this.hls.startLoad(); else this.reset(); }});
                } else if(this.el.canPlayType('application/vnd.apple.mpegurl')) { this.el.src=url; this.el.play(); }
            },
            toggleFull: function() {
                var w=document.getElementById('vid-wrapper');
                // Toggler mais limpo e rápido
                if(w.classList.contains('fs-mode')) { 
                    w.classList.remove('fs-mode'); 
                    App.osd("MODO JANELA"); 
                } else { 
                    w.classList.add('fs-mode'); 
                    App.osd("TELA CHEIA"); 
                }
            }
        };

        var App = {
            scr: 0, zone: 0, idx: 0, creds: {h:'', u:'', p:''}, data: [], fullData: [], catData: [],
            
            init: function() {
                if(localStorage.getItem('vp_h')) {
                    document.getElementById('i0').value=localStorage.getItem('vp_h');
                    document.getElementById('i1').value=localStorage.getItem('vp_u');
                    document.getElementById('i2').value=localStorage.getItem('vp_p');
                }
                Player.init(); setInterval(()=>{var d=new Date();document.getElementById('clock').innerText=d.getHours()+':'+(d.getMinutes()<10?'0':'')+d.getMinutes();},1000);
                this.updateFocus();
            },

            req: function(url, cb) {
                var x = new XMLHttpRequest(); x.open("GET", url, true); x.timeout = 15000;
                x.onload=function(){if(x.status===200){try{cb(JSON.parse(x.responseText))}catch(e){cb(null)}}else cb(null)};
                x.onerror=function(){cb(null)}; x.send();
            },

            login: function() {
                var h=document.getElementById('i0').value.trim(), u=document.getElementById('i1').value.trim(), p=document.getElementById('i2').value.trim();
                if(!h.startsWith('http')) h='http://'+h;
                this.loading(true);
                this.req(h+"/player_api.php?username="+u+"&password="+p, (d)=>{
                    this.loading(false);
                    if(d && d.user_info && d.user_info.auth==1) {
                        this.creds={h:h,u:u,p:p}; localStorage.setItem('vp_h',h); localStorage.setItem('vp_u',u); localStorage.setItem('vp_p',p);
                        var info = d.user_info;
                        document.getElementById('info-user').innerText = info.username || u;
                        document.getElementById('info-created').innerText = info.created_at?new Date(info.created_at*1000).toLocaleDateString("pt-BR"):"--/--/--";
                        document.getElementById('info-screens').innerText = (info.active_cons||0)+" / "+(info.max_connections||1);
                        document.getElementById('info-exp').innerText = info.exp_date?new Date(info.exp_date*1000).toLocaleDateString("pt-BR"):"Ilimitado";
                        this.setScr(1);
                    } else document.getElementById('msg-login').innerText="Erro: Verifique os dados!";
                });
            },
            logout: function() { localStorage.clear(); location.reload(); },

            setScr: function(n) {
                document.querySelectorAll('.layer').forEach(e=>e.classList.add('hide'));
                if(n===0) document.getElementById('login-layer').classList.remove('hide');
                if(n===1) { Player.reset(); document.getElementById('dash-layer').classList.remove('hide'); }
                if(n===2) document.getElementById('content-layer').classList.remove('hide');
                this.scr=n; this.zone=0; this.idx=0; this.updateFocus();
            },

            openMode: function(m) {
                this.mode=m; this.setScr(2); this.loading(true);
                // LIMPEZA TOTAL
                document.getElementById('cat-list').innerHTML = ''; document.getElementById('item-list').innerHTML = '';
                document.getElementById('meta-title').innerText = "Carregando..."; document.getElementById('meta-desc').innerText = "";
                Player.reset(); this.catData = []; this.data = [];
                
                var act=(m==='live')?'get_live_categories':(m==='movie'?'get_vod_categories':'get_series_categories');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act, (d)=>{
                    this.loading(false);
                    if(d) {
                        var h=''; d.forEach((c,i)=>{h+=`<div class="cat-item" id="c${i}" onclick="App.clickCat(${i})">${c.category_name}</div>`});
                        document.getElementById('cat-list').innerHTML=h; this.catData=d; this.zone=0; this.idx=0; this.updateFocus();
                    }
                });
            },

            clickCat: function(i) {
                this.idx=i; this.zone=0; var cid=this.catData[i].category_id;
                document.querySelectorAll('.cat-item').forEach(e=>e.classList.remove('active')); document.getElementById('c'+i).classList.add('active');
                
                // LIMPEZA LISTA
                document.getElementById('item-list').innerHTML = '<div style="padding:20px; color:#555">Carregando...</div>';
                this.data = [];
                
                this.loading(true);
                var act=(this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act+"&category_id="+cid, (d)=>{
                    this.loading(false); 
                    if(d) { this.fullData=d; this.renderList(d); }
                    else { document.getElementById('item-list').innerHTML = '<div style="padding:20px; color:#555">Vazio</div>'; }
                });
            },

            renderList: function(list) {
                this.data=list; var h='', max=list.length>100?100:list.length;
                if(max === 0) { document.getElementById('item-list').innerHTML = '<div style="padding:20px; color:#555">Vazio</div>'; return; }
                for(var i=0;i<max;i++) { var n=list[i].name||list[i].title; h+=`<div class="item" id="r${i}" onclick="App.playItem(${i})">${n}</div>`; }
                document.getElementById('item-list').innerHTML=h; this.zone=2; this.idx=0; this.updateFocus();
            },

            playItem: function(i) {
                Player.reset();
                document.getElementById('meta-title').innerText = ""; document.getElementById('meta-desc').innerText = ""; document.getElementById('meta-epg').innerText = "";
                
                var item=this.data[i];
                var id=item.stream_id||item.series_id;
                var ext=(this.mode==='live')?'ts':(item.container_extension||'mp4');

                document.getElementById('meta-title').innerText=item.name||item.title;
                document.querySelectorAll('.item').forEach(e=>e.classList.remove('playing')); document.getElementById('r'+i).classList.add('playing');
                
                if(this.mode==='series') { App.osd("Séries: Use Modo Completo"); return; }
                
                var url=`${this.creds.h}/${this.mode}/${this.creds.u}/${this.creds.p}/${id}.${ext}`;
                Player.play(url, this.mode==='live');
            },

            doSearch: function() {
                var q=document.getElementById('search').value.toLowerCase(); if(q.length<2) return;
                var res=this.fullData.filter(i=>(i.name||i.title).toLowerCase().includes(q)); this.renderList(res);
            },

            move: function(d) {
                if(this.scr===1) { if(d===1&&this.idx<3)this.idx++; if(d===3&&this.idx>0)this.idx--; }
                else if(this.scr===2) { 
                    if(this.zone===0) { var max=document.getElementById('cat-list').children.length-1; if(d===2&&this.idx<max)this.idx++; if(d===0&&this.idx>0)this.idx--; if(d===1){this.zone=2;this.idx=0;} }
                    else if(this.zone===2) { var max=document.getElementById('item-list').children.length-1; if(d===2&&this.idx<max)this.idx++; if(d===0){if(this.idx>0)this.idx--;else this.zone=1;} if(d===3){this.zone=0;this.idx=0;} if(d===1)this.zone=3; }
                    else if(this.zone===1) { if(d===2){this.zone=2;this.idx=0;} if(d===3){this.zone=0;this.idx=0;} }
                    else if(this.zone===3) { if(d===3){this.zone=2;this.idx=0;} }
                }
                this.updateFocus();
            },

            enter: function() {
                if(this.scr===0) this.login();
                else if(this.scr===1) { if(this.idx===3)this.logout(); else this.openMode(['live','movie','series'][this.idx]); }
                else if(this.scr===2) { if(this.zone===0)this.clickCat(this.idx); else if(this.zone===2)this.playItem(this.idx); else if(this.zone===1)this.doSearch(); else if(this.zone===3)Player.toggleFull(); }
            },

            back: function() {
                if(document.getElementById('vid-wrapper').classList.contains('fs-mode')) { Player.toggleFull(); return; }
                if(this.scr===2) { if(this.zone===3){this.zone=2;this.updateFocus();return;} this.setScr(1); }
            },

            updateFocus: function() {
                document.querySelectorAll('.focused').forEach(e=>e.classList.remove('focused')); var el;
                if(this.scr===0) el=document.getElementById('i'+this.idx);
                if(this.scr===1) el=document.getElementById('m'+this.idx);
                if(this.scr===2) {
                    if(this.zone===0) el=document.getElementById('c'+this.idx);
                    if(this.zone===1) el=document.getElementById('search');
                    if(this.zone===2) el=document.getElementById('r'+this.idx);
                    if(this.zone===3) el=document.getElementById('vid-wrapper');
                }
                if(el) { el.classList.add('focused'); el.scrollIntoView({block:'center', behavior:'auto'}); if(el.tagName==='INPUT')el.focus(); else document.activeElement.blur(); }
            },
            osd: function(msg) { var o=document.getElementById('osd'); o.innerText=msg; o.style.display='block'; setTimeout(()=>o.style.display='none',3000); },
            loading: function(show) { document.getElementById('loader').classList.toggle('hide', !show); }
        };

        document.addEventListener('keydown', function(e) {
            var k = e.keyCode;
            if(k===403||k===82) { e.preventDefault(); Player.toggleFull(); } 
            if(k===404||k===71) { e.preventDefault(); App.zone=0; App.idx=0; App.updateFocus(); }
            if(k===405||k===89) { e.preventDefault(); App.zone=1; App.updateFocus(); }
            if(k===406||k===66||k===275) { e.preventDefault(); App.setScr(1); }

            if(k===37) App.move(3); if(k===38) App.move(0); if(k===39) App.move(1); if(k===40) App.move(2);
            if(k===13) App.enter(); if(k===8||k===27||k===461||k===10009) App.back();
            if(document.activeElement.tagName==='INPUT') {
                if(k===40){e.preventDefault(); if(App.scr===2)App.move(2);else App.idx++; App.updateFocus();}
                if(k===38&&App.scr===0){e.preventDefault(); App.idx--; App.updateFocus();}
                if(k===13)App.enter(); return;
            }
            e.preventDefault();
        });
    </script>
</body>
</html>
