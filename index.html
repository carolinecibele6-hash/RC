<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R&C PRO V26</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILO GOLD PRO --- */
        :root { --bg: #000; --gold: #FFD700; --gray: #1a1a1a; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg); color: #fff;
            font-family: 'Montserrat', sans-serif;
            width: 100vw; height: 100vh; overflow: hidden;
        }

        .hide { display: none !important; }
        
        /* HEADER */
        .header {
            height: 10vh; display: flex; align-items: center; justify-content: space-between;
            padding: 0 4vw; background: #050505; border-bottom: 2px solid #222;
        }
        .logo { font-size: 3vh; font-weight: 800; }
        .logo span { color: var(--gold); }
        .keys-hint { font-size: 1.5vh; color: #666; display: flex; gap: 15px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }

        /* --- LOGIN (FIXED) --- */
        #screen-login { height: 90vh; display: flex; align-items: center; justify-content: center; }
        .login-box { width: 40%; background: #111; padding: 40px; border: 1px solid #333; border-radius: 10px; }
        .inp-row { margin-bottom: 15px; }
        .inp-row label { display: block; color: var(--gold); font-size: 12px; margin-bottom: 5px; }
        .ipt { 
            width: 100%; height: 45px; background: #000; border: 1px solid #444; color: white; 
            font-size: 18px; padding-left: 10px;
        }
        .btn-enter {
            width: 100%; height: 50px; background: #222; color: #fff; border: 1px solid var(--gold);
            font-weight: bold; margin-top: 20px; font-size: 18px; cursor: pointer;
        }
        /* Foco no botão deixa ele dourado */
        .btn-enter.focused { background: var(--gold); color: #000; }

        /* --- DASHBOARD --- */
        #screen-dash { height: 90vh; display: flex; align-items: center; justify-content: center; gap: 30px; }
        .tile {
            width: 20vw; height: 30vh; background: #111; border: 2px solid #222;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .tile i { font-size: 6vh; color: #555; margin-bottom: 20px; }
        
        /* --- LISTAS --- */
        #screen-list { height: 90vh; display: flex; }
        .sidebar { width: 30%; background: #080808; border-right: 1px solid #222; overflow-y: auto; height: 100%; }
        .content { width: 70%; background: #000; overflow-y: auto; height: 100%; padding: 20px; }
        
        .list-item { padding: 15px; border-bottom: 1px solid #1a1a1a; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- BUSCA --- */
        #screen-search { height: 90vh; display: flex; flex-direction: column; align-items: center; padding-top: 50px; background: rgba(0,0,0,0.95); }
        .search-bar { width: 60%; font-size: 30px; padding: 10px; text-align: center; background: #111; border: 2px solid var(--gold); color: white; }
        #search-results { width: 80%; margin-top: 30px; overflow-y: auto; height: 60vh; }

        /* --- PLAYER --- */
        #screen-player { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:999; }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* --- FOCUS SYSTEM --- */
        .focused {
            border-color: var(--gold) !important;
            background: var(--gold) !important;
            color: #000 !important;
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
            font-weight: bold;
            z-index: 10;
        }
        .focused i { color: #000 !important; }
        .tile.focused { transform: scale(1.1); }
        
        /* Loading */
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:2000; display:flex; justify-content:center; align-items:center; flex-direction:column; }
        #toast { position: fixed; top: 20px; right: 20px; background: var(--gold); color: black; padding: 10px 20px; font-weight: bold; z-index: 3000; display: none; }
    </style>
</head>
<body>

    <div id="loading" class="hide">
        <h2 style="color:var(--gold)">CARREGANDO...</h2>
    </div>
    <div id="toast">AÇÃO</div>

    <div class="header">
        <div class="logo">R&C <span>PRO</span></div>
        <div class="keys-hint">
            <span><span class="dot" style="background:red"></span>FULL</span>
            <span><span class="dot" style="background:green"></span>TOPO</span>
            <span><span class="dot" style="background:yellow"></span>BUSCA</span>
            <span><span class="dot" style="background:blue"></span>MENU</span>
        </div>
    </div>

    <div id="screen-login">
        <div class="login-box">
            <div class="inp-row">
                <label>SERVIDOR (DNS)</label>
                <input type="text" id="host" class="ipt focusable" placeholder="http://...">
            </div>
            <div class="inp-row">
                <label>USUÁRIO</label>
                <input type="text" id="user" class="ipt focusable">
            </div>
            <div class="inp-row">
                <label>SENHA</label>
                <input type="password" id="pass" class="ipt focusable">
            </div>
            <button class="btn-enter focusable" onclick="App.doLogin()">ENTRAR</button>
        </div>
    </div>

    <div id="screen-dash" class="hide">
        <div class="tile focusable" onclick="App.loadCats('live')"><i class="fas fa-tv"></i>TV AO VIVO</div>
        <div class="tile focusable" onclick="App.loadCats('movie')"><i class="fas fa-film"></i>FILMES</div>
        <div class="tile focusable" onclick="App.loadCats('series')"><i class="fas fa-video"></i>SÉRIES</div>
        <div class="tile focusable" onclick="App.changeUser()"><i class="fas fa-user-cog"></i>TROCAR CONTA</div>
    </div>

    <div id="screen-list" class="hide">
        <div class="sidebar" id="list-cats"></div>
        <div class="content" id="list-items"></div>
    </div>

    <div id="screen-search" class="hide">
        <input type="text" id="search-input" class="search-bar focusable" placeholder="DIGITE E APERTE OK">
        <div id="search-results"></div>
    </div>

    <div id="screen-player" class="hide">
        <video id="player"></video>
    </div>

    <script>
        const App = {
            scr: 'login', // login, dash, cats, items, search, player
            items: [],
            idx: 0,
            creds: {},
            
            // Variáveis de Estado
            type: '',
            playList: [],
            playIdx: 0,

            init: function() {
                // Tenta Login Automático
                const s = localStorage.getItem('rc_v26_creds');
                if(s) {
                    this.creds = JSON.parse(s);
                    document.getElementById('host').value = this.creds.host;
                    document.getElementById('user').value = this.creds.user;
                    document.getElementById('pass').value = this.creds.pass;
                    // Foca no botão conectar direto
                    setTimeout(() => { this.scan(); this.idx = 3; this.update(); }, 500);
                } else {
                    this.scan();
                }

                // Evento de Teclado Global
                document.addEventListener('keydown', (e) => this.handleKey(e));
                
                // Auto Play
                document.getElementById('player').addEventListener('ended', () => this.nextVideo());
            },

            // --- NAVEGAÇÃO ---
            scan: function() {
                let s = '';
                if(this.scr === 'login') s = '#screen-login .focusable';
                if(this.scr === 'dash') s = '#screen-dash .focusable';
                if(this.scr === 'cats') s = '#list-cats .list-item';
                if(this.scr === 'items') s = '#list-items .list-item';
                if(this.scr === 'search') s = '#screen-search .focusable, #search-results .list-item';
                
                this.items = document.querySelectorAll(s);
                if(this.idx >= this.items.length) this.idx = 0;
                this.update();
            },

            update: function() {
                document.querySelectorAll('.focused').forEach(e => e.classList.remove('focused'));
                if(this.items[this.idx]) {
                    const el = this.items[this.idx];
                    el.classList.add('focused');
                    el.scrollIntoView({block: 'center', behavior: 'auto'});
                    
                    // Lógica do Teclado (Importante!)
                    if(el.tagName === 'INPUT') {
                        el.focus(); 
                    } else {
                        // Se não for input, tira o foco de qualquer input para fechar teclado
                        if(document.activeElement.tagName === 'INPUT') document.activeElement.blur();
                        el.focus();
                    }
                }
            },

            // --- CONTROLE REMOTO ---
            handleKey: function(e) {
                const k = e.keyCode;

                // 1. BOTÕES COLORIDOS (PRIORIDADE)
                if(k === 403 || k === 122) { // VERMELHO -> Fullscreen
                    this.toggleFull(); return;
                }
                if(k === 404) { // VERDE -> Topo
                    this.idx = 0; this.update(); return;
                }
                if(k === 405) { // AMARELO -> Busca
                    this.openSearch(); return;
                }
                if(k === 406) { // AZUL -> Menu Principal
                    this.closePlayer();
                    this.setScreen('dash'); return;
                }

                // 2. PLAYER NAV
                if(this.scr === 'player') {
                    e.preventDefault();
                    const v = document.getElementById('player');
                    if(k===13 || k===19) v.paused ? v.play() : v.pause();
                    if(k===39) v.currentTime += 15;
                    if(k===37) v.currentTime -= 15;
                    if(k===8 || k===461 || k===10009) this.closePlayer();
                    return;
                }

                // 3. GERAL NAV
                if(k===8 || k===461 || k===10009) { // Voltar
                    if(this.scr === 'items') { this.scr = 'cats'; this.scan(); }
                    else if(this.scr === 'cats' || this.scr === 'search') { this.setScreen('dash'); }
                    return;
                }

                if(k===38) { // Cima
                    this.idx--; if(this.idx < 0) this.idx = 0;
                    this.update();
                }
                else if(k===40) { // Baixo
                    this.idx++; if(this.idx >= this.items.length) this.idx = this.items.length-1;
                    this.update();
                }
                else if(k===39) { // Direita
                    if(this.scr === 'cats') { this.scr = 'items'; this.idx=0; this.scan(); }
                    else if(this.scr === 'dash') { this.idx++; if(this.idx >= this.items.length) this.idx = this.items.length-1; this.update(); }
                }
                else if(k===37) { // Esquerda
                    if(this.scr === 'items') { this.scr = 'cats'; this.scan(); }
                    else if(this.scr === 'dash') { this.idx--; if(this.idx < 0) this.idx=0; this.update(); }
                }
                else if(k===13) { // Enter
                    if(this.items[this.idx]) {
                        // Se estiver no Input, fecha teclado e tenta logar se for senha
                        if(this.items[this.idx].id === 'search-input') { this.doSearch(); return; }
                        this.items[this.idx].click();
                    }
                }
            },

            // --- LÓGICA LOGIN ---
            doLogin: function() {
                const h = document.getElementById('host').value;
                const u = document.getElementById('user').value;
                const p = document.getElementById('pass').value;
                
                if(!h || !u || !p) return;
                
                this.load(true);
                fetch(`${h}/player_api.php?username=${u}&password=${p}&action=get_live_categories`)
                .then(r => r.json())
                .then(d => {
                    localStorage.setItem('rc_v26_creds', JSON.stringify({host:h, user:u, pass:p}));
                    this.creds = {host:h, user:u, pass:p};
                    this.setScreen('dash');
                    this.load(false);
                })
                .catch(e => {
                    this.load(false);
                    alert("Erro de conexão.");
                });
            },

            changeUser: function() {
                localStorage.removeItem('rc_v26_creds');
                location.reload();
            },

            // --- CONTEÚDO ---
            loadCats: function(type) {
                this.type = type;
                this.load(true);
                const url = `${this.creds.host}/player_api.php?username=${this.creds.user}&password=${this.creds.pass}&action=`;
                const act = type==='live' ? 'get_live_categories' : (type==='movie' ? 'get_vod_categories' : 'get_series_categories');

                fetch(url+act).then(r=>r.json()).then(d => {
                    const c = document.getElementById('list-cats');
                    c.innerHTML = '';
                    d.forEach(i => {
                        const el = document.createElement('div');
                        el.className = 'list-item focusable';
                        el.innerText = i.category_name;
                        el.onclick = () => {
                            // Limpa visual
                            Array.from(c.children).forEach(x=>x.style.color='#888');
                            el.style.color= 'var(--gold)';
                            this.loadItems(i.category_id);
                        };
                        c.appendChild(el);
                    });
                    this.setScreen('cats');
                    this.load(false);
                    // Reseta area de itens
                    document.getElementById('list-items').innerHTML = '<h3 style="color:#444">SELECIONE UMA CATEGORIA</h3>';
                });
            },

            loadItems: function(catId) {
                this.load(true);
                const url = `${this.creds.host}/player_api.php?username=${this.creds.user}&password=${this.creds.pass}&action=`;
                let act = '';
                if(this.type==='live') act=`get_live_streams&category_id=${catId}`;
                if(this.type==='movie') act=`get_vod_streams&category_id=${catId}`;
                if(this.type==='series') act=`get_series&category_id=${catId}`;

                fetch(url+act).then(r=>r.json()).then(d => {
                    const c = document.getElementById('list-items');
                    c.innerHTML = '';
                    this.playList = d; // Salva para auto-play

                    d.forEach((i, index) => {
                        const el = document.createElement('div');
                        el.className = 'list-item focusable';
                        el.innerText = i.name;
                        el.onclick = () => {
                            this.playIdx = index;
                            this.play(i);
                        };
                        c.appendChild(el);
                    });
                    this.load(false);
                    // Pula automaticamente para a direita
                    this.scr = 'items'; this.idx = 0; this.scan();
                });
            },

            // --- BUSCA ---
            openSearch: function() {
                this.setScreen('search');
                document.getElementById('search-results').innerHTML = '';
                document.getElementById('search-input').value = '';
                this.idx = 0; this.scan();
            },

            doSearch: function() {
                const term = document.getElementById('search-input').value;
                if(term.length < 3) return;
                
                this.load(true);
                document.getElementById('search-input').blur(); // Fecha teclado
                
                // Busca em VOD (Padrão)
                fetch(`${this.creds.host}/player_api.php?username=${this.creds.user}&password=${this.creds.pass}&action=get_vod_streams`)
                .then(r=>r.json()).then(d => {
                    const res = d.filter(i => i.name.toLowerCase().includes(term.toLowerCase()));
                    const c = document.getElementById('search-results');
                    c.innerHTML = '';
                    this.type = 'movie'; // Assume filme na busca
                    
                    res.forEach(i => {
                        const el = document.createElement('div');
                        el.className = 'list-item focusable';
                        el.innerText = i.name;
                        el.onclick = () => this.play(i);
                        c.appendChild(el);
                    });
                    this.load(false);
                    this.scan();
                });
            },

            // --- PLAYER ---
            play: function(item) {
                const v = document.getElementById('player');
                let url = '';
                if(this.type === 'live') url = `${this.creds.host}/live/${this.creds.user}/${this.creds.pass}/${item.stream_id}.m3u8`;
                else url = `${this.creds.host}/movie/${this.creds.user}/${this.creds.pass}/${item.stream_id}.${item.container_extension || 'mp4'}`;

                this.scr = 'player';
                document.getElementById('screen-player').classList.remove('hide');
                
                this.toast(`TOCANDO: ${item.name}`);

                if(Hls.isSupported() && url.includes('.m3u8')) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(v);
                    hls.on(Hls.Events.MANIFEST_PARSED, ()=>v.play());
                } else {
                    v.src = url;
                    v.play();
                }
            },

            nextVideo: function() {
                if(this.type === 'live') return;
                this.playIdx++;
                if(this.playIdx < this.playList.length) {
                    this.toast("PRÓXIMO VÍDEO...");
                    setTimeout(() => this.play(this.playList[this.playIdx]), 2000);
                } else {
                    this.closePlayer();
                }
            },

            closePlayer: function() {
                const v = document.getElementById('player');
                v.pause(); v.src = "";
                document.getElementById('screen-player').classList.add('hide');
                this.scr = 'items'; this.scan();
            },

            toggleFull: function() {
                if(!document.fullscreenElement) document.documentElement.requestFullscreen();
                else document.exitFullscreen();
            },

            // --- UTIL ---
            setScreen: function(s) {
                ['login','dash','list','search','player'].forEach(x => document.getElementById('screen-'+x).classList.add('hide'));
                document.getElementById('screen-'+s).classList.remove('hide');
                this.scr = s;
                this.idx = 0;
                this.scan();
            },

            load: function(s) { document.getElementById('loading').classList.toggle('hide', !s); },
            
            toast: function(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg; t.style.display='block';
                setTimeout(()=>t.style.display='none', 3000);
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
