// --- FUNÇÕES AUXILIARES DE FULLSCREEN (Compatibilidade TV) ---
        function isFullscreen() {
            return document.fullscreenElement || 
                   document.webkitFullscreenElement || 
                   document.mozFullScreenElement || 
                   document.msFullscreenElement || 
                   null;
        }

        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen(); // Chrome, Safari, WebOS, Tizen
            else if (document.mozCancelFullScreen) document.mozCancelFullScreen(); // Firefox
            else if (document.msExitFullscreen) document.msExitFullscreen(); // IE/Edge antigo
        }

        // --- GLOBAL KEY LISTENER ---
        function doLogin() { App.login(); } // Wrapper
        
        document.addEventListener('keydown', (e) => {
            let k = e.keyCode;
            
            // LOGIN INPUTS (Navegação básica)
            if(App.screen === 'login') {
                if(k===13) {
                    if(document.activeElement.id === 'btnEnter') doLogin();
                    else document.activeElement.click();
                }
                if(k===40) { // Descer input
                    let map = ['h','u','p','btnEnter'];
                    let curr = map.indexOf(document.activeElement.id);
                    if(curr < 3) document.getElementById(map[curr+1]).focus();
                }
                if(k===38) { // Subir input
                    let map = ['h','u','p','btnEnter'];
                    let curr = map.indexOf(document.activeElement.id);
                    if(curr > 0) document.getElementById(map[curr-1]).focus();
                }
                return;
            }

            // PREVINE SCROLL PADRÃO DO NAVEGADOR COM AS SETAS
            if([37,38,39,40].includes(k)) e.preventDefault();

            // --- LÓGICA DO BOTÃO VOLTAR / SAIR (CORRIGIDA) ---
            // 8: Backspace (PC), 461: Back (LG), 10009: Back (Samsung), 27: Esc
            if(k === 8 || k === 461 || k === 27 || k === 10009) {
                e.preventDefault(); // Previne que a TV feche o app inteiro

                if(isFullscreen()) {
                    // SE ESTIVER EM TELA CHEIA, APENAS SAI DA TELA CHEIA
                    exitFullscreen();
                    
                    // Garante que o foco volte para o player ou lista
                    setTimeout(() => {
                        let box = document.getElementById('v-box');
                        box.classList.remove('active'); // Remove brilho extra se quiser
                        App.renderFocus(); // Garante o foco visual de volta
                    }, 200);
                } 
                else if(App.zone === 2) { 
                    // SE NÃO ESTÁ EM TELA CHEIA E ESTÁ NA LISTA -> VAI PARA CATEGORIAS
                    App.zone = 1; 
                    App.renderFocus(); 
                }
                else if(App.zone === 1) {
                    // SE ESTÁ NAS CATEGORIAS -> SOBE PRO MENU
                    App.zone = 0;
                    App.renderFocus();
                }
                return;
            }

            App.handleKey(k);
        });
