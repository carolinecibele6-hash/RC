<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NETRANGE LITE</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* --- ESTILO ULTRA LEVE (BARE METAL) --- */
        :root { 
            --bg: #000000; 
            --panel: #111111;
            --focus: #00C851; /* Verde Netrange */
            --text: #ffffff;
            --text-dim: #888888;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg); 
            color: var(--text);
            font-family: sans-serif; /* Fonte do sistema é mais leve */
            width: 100vw; height: 100vh; overflow: hidden;
        }

        .hide { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: var(--bg); }

        /* --- SISTEMA DE FOCO (ALTA PERFORMANCE) --- */
        .focusable {
            border: 2px solid transparent;
            /* SEM TRANSIÇÃO */
        }

        .focused {
            border: 3px solid var(--focus) !important;
            background-color: #222 !important;
            color: #fff !important;
            z-index: 50;
            /* SEM SOMBRA (Box-shadow mata TV velha) */
            /* SEM TRANSFORM (Scale mata TV velha) */
        }
        
        /* CORREÇÃO DO PLAYER */
        #vid-box.focused { border: 3px solid var(--focus) !important; }

        /* FULLSCREEN */
        #vid-box.fs {
            position: fixed !important; top: 0 !important; left: 0 !important;
            width: 100% !important; height: 100% !important; z-index: 9999 !important;
            border: none !important;
        }

        /* --- LOGIN --- */
        .login-box { 
            width: 400px; padding: 30px; 
            background: var(--panel); border: 1px solid #333; 
            text-align: center; 
        }
        .logo-txt { font-size: 28px; font-weight: bold; margin-bottom: 20px; color: var(--focus); }
        
        .inp { 
            width: 100%; padding: 10px; margin: 5px 0; 
            background: #000; border: 1px solid #444; 
            color: #fff; text-align: center; font-size: 16px;
        }
        
        .btn { 
            width: 100%; padding: 12px; margin-top: 15px; 
            background: #006400; color: #fff; border: none; 
            font-weight: bold; font-size: 16px; 
        }
        .btn.focused { background: var(--focus) !important; border: 2px solid #fff !important; }

        /* --- DASHBOARD --- */
        #dash-layer { display: flex; flex-direction: column; padding: 20px; }

        .top-bar { height: 60px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; margin-bottom: 20px; }
        .dash-logo { font-size: 24px; font-weight: bold; color: var(--focus); }
        .dash-clock { font-size: 18px; color: #ccc; }

        .dash-grid { display: flex; gap: 20px; justify-content: center; align-items: center; flex: 1; }
        
        .smart-card { 
            width: 200px; height: 200px;
            background: var(--panel); border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .smart-card i { font-size: 60px; margin-bottom: 20px; color: #555; }
        .smart-card span { font-size: 16px; font-weight: bold; color: #ccc; }
        .smart-card.focused i { color: var(--focus); }

        .bottom-bar { display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid #333; }
        .info-txt { font-size: 14px; color: #888; }

        /* --- CONTEÚDO --- */
        #content-layer { display: flex; height: 100%; }
        
        .col-cat { width: 250px; background: #050505; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .cat-head { padding: 15px; background: var(--panel); color: var(--focus); font-weight: bold; text-align: center; border-bottom: 1px solid #333; }
        .cat-list { flex: 1; overflow-y: auto; }
        
        .cat-item { 
            padding: 10px 15px; border-bottom: 1px solid #111; 
            color: #aaa; font-size: 14px; white-space: nowrap; overflow: hidden; 
        }
        .cat-item.active { background: #222; color: #fff; border-left: 4px solid var(--focus); font-weight: bold; }

        .col-list { width: 350px; background: var(--panel); border-right: 1px solid #333; display: flex; flex-direction: column; }
        .search-area { padding: 10px; border-bottom: 1px solid #333; }
        .inp-search { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 8px; text-align: center; }
        
        .item-list { flex: 1; overflow-y: auto; }
        .item { 
            padding: 12px 15px; border-bottom: 1px solid #222; 
            color: #ccc; font-size: 14px; white-space: nowrap; overflow: hidden; 
        }
        .item.playing { color: var(--focus); font-weight: bold; }

        .col-play { flex: 1; background: #000; display: flex; flex-direction: column; }
        .vid-box { width: 100%; height: 50%; background: #000; border-bottom: 1px solid #333; position: relative; }
        video { width: 100%; height: 100%; }

        .meta { padding: 20px; flex: 1; overflow: hidden; background: #080808; }
        .meta-title { font-size: 22px; color: var(--focus); font-weight: bold; margin-bottom: 10px; }
        .meta-desc { font-size: 14px; color: #888; line-height: 1.4; }

        #loader { background: rgba(0,0,0,0.9); z-index: 9999; flex-direction: column; color: var(--focus); font-weight: bold; }
        .osd-status { position: absolute; top: 20px; right: 20px; background: #000; color: #fff; padding: 5px 10px; border: 1px solid #fff; display: none; }
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="hide flex-center">
        <div style="font-size: 40px; margin-bottom: 10px;"><i class="fas fa-spinner fa-spin"></i></div>
        <div id="load-txt">CARREGANDO...</div>
    </div>

    <div id="login-layer" class="layer flex-center">
        <div class="login-box">
            <div class="logo-txt"><i class="fas fa-tv"></i> NETRANGE PLAYER</div>
            <input type="text" id="i0" class="inp focusable" placeholder="URL DNS">
            <input type="text" id="i1" class="inp focusable" placeholder="USUÁRIO">
            <input type="password" id="i2" class="inp focusable" placeholder="SENHA">
            <button id="i3" class="btn focusable" onclick="App.login()">ENTRAR</button>
            <div id="msg-login" style="color:red; margin-top:10px;"></div>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="top-bar">
            <div class="dash-logo"><i class="fas fa-tv"></i> NETRANGE</div>
            <div id="clock-display" class="dash-clock">00:00</div>
            <div id="m3" class="smart-card focusable" style="width:60px; height:60px;" onclick="App.logout()">
                <i class="fas fa-power-off" style="font-size:24px; margin:0;"></i>
            </div>
        </div>

        <div class="dash-grid">
            <div id="m0" class="smart-card focusable" onclick="App.openMode('live')">
                <i class="fas fa-tv"></i><span>TV AO VIVO</span>
            </div>
            <div id="m1" class="smart-card focusable" onclick="App.openMode('movie')">
                <i class="fas fa-film"></i><span>FILMES</span>
            </div>
            <div id="m2" class="smart-card focusable" onclick="App.openMode('series')">
                <i class="fas fa-list"></i><span>SÉRIES</span>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="info-txt">Vencimento: <span id="info-exp">...</span></div>
            <div class="info-txt">Conexões: <span id="info-conn">...</span></div>
        </div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="col-cat">
            <div class="cat-head">CATEGORIAS</div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="col-list">
            <div class="search-area">
                <input type="text" id="search" class="inp-search focusable" placeholder="PESQUISAR..." onkeydown="if(event.keyCode==13) App.doSearch()">
            </div>
            <div id="item-list" class="item-list"></div>
        </div>
        <div class="col-play">
            <div id="vid-box" class="vid-box focusable">
                <video id="player"></video>
                <div id="osd" class="osd-status"></div>
            </div>
            <div class="meta">
                <div id="meta-title" class="meta-title">SELECIONE UM CANAL</div>
                <div id="meta-desc" class="meta-desc">Use a busca para encontrar canais específicos. A lista exibe no máximo 50 itens para não travar sua TV.</div>
            </div>
        </div>
    </div>

    <script>
        var PlayerEngine = {
            hls: null, video: null,
            init: function() { this.video = document.getElementById('player'); },
            play: function(url) {
                if(this.hls) { this.hls.destroy(); this.hls = null; }
                
                // CONFIGURAÇÃO ULTRA LEVE PARA PHILCO
                if(Hls.isSupported() && url.includes('.m3u8')) {
                    this.hls = new Hls({
                        enableWorker: false, // Worker pode pesar em CPU fraca
                        maxBufferLength: 10, // Buffer pequeno para economizar RAM
                        maxMaxBufferLength: 10,
                        manifestLoadingTimeOut: 15000
                    });
                    this.hls.loadSource(url);
                    this.hls.attachMedia(this.video);
                    this.hls.on(Hls.Events.MANIFEST_PARSED, function() { PlayerEngine.video.play(); });
                } else {
                    this.video.src = url;
                    this.video.play();
                }
            },
            stop: function() {
                if(this.hls) { this.hls.destroy(); this.hls = null; }
                this.video.pause(); this.video.removeAttribute('src'); this.video.load();
            }
        };

        var App = {
            scr: 0, zone: 0, idx: 0, creds: {}, fullData: [],
            
            init: function() {
                if(localStorage.getItem('nr_h')) {
                    document.getElementById('i0').value = localStorage.getItem('nr_h');
                    document.getElementById('i1').value = localStorage.getItem('nr_u');
                    document.getElementById('i2').value = localStorage.getItem('nr_p');
                }
                PlayerEngine.init();
                setInterval(function(){ 
                    var d = new Date(); 
                    document.getElementById('clock-display').innerText = d.toLocaleTimeString('pt-BR').substring(0,5);
                }, 1000);
                this.updateFocus();
            },

            req: function(url, cb) {
                var x = new XMLHttpRequest(); x.open("GET", url, true); x.timeout = 15000;
                x.onload = function() { if(x.status===200) { try{cb(JSON.parse(x.responseText));}catch(e){cb(null);} } else cb(null); };
                x.onerror = function(){ cb(null); }; x.send();
            },

            login: function() {
                var h = document.getElementById('i0').value.trim();
                var u = document.getElementById('i1').value.trim();
                var p = document.getElementById('i2').value.trim();
                if(h.indexOf('http') === -1) h = 'http://' + h;
                
                document.getElementById('loader').classList.remove('hide');
                document.getElementById('load-txt').innerText = "ENTRANDO...";
                
                this.req(h+"/player_api.php?username="+u+"&password="+p, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d && d.user_info && d.user_info.auth==1) {
                        App.creds={h:h,u:u,p:p};
                        localStorage.setItem('nr_h', h); localStorage.setItem('nr_u', u); localStorage.setItem('nr_p', p);
                        
                        var info = d.user_info;
                        document.getElementById('info-exp').innerText = new Date(info.exp_date*1000).toLocaleDateString("pt-BR");
                        document.getElementById('info-conn').innerText = (info.active_cons||0) + "/" + (info.max_connections||1);
                        
                        App.setScr(1);
                    } else document.getElementById('msg-login').innerText="Erro de Login";
                });
            },
            logout: function() { localStorage.clear(); location.reload(); },

            setScr: function(n) {
                if(n===1) PlayerEngine.stop();
                document.querySelectorAll('.layer').forEach(function(l){l.classList.add('hide')});
                if(n===0) document.getElementById('login-layer').classList.remove('hide');
                if(n===1) document.getElementById('dash-layer').classList.remove('hide');
                if(n===2) document.getElementById('content-layer').classList.remove('hide');
                this.scr=n; this.zone=0; this.idx=0; this.updateFocus();
            },

            openMode: function(m) {
                this.mode = m; this.setScr(2);
                document.getElementById('cat-list').innerHTML = ''; document.getElementById('item-list').innerHTML = '';
                document.getElementById('loader').classList.remove('hide');
                var act = (m==='live')?'get_live_categories':(m==='movie'?'get_vod_categories':'get_series_categories');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        var h=''; for(var i=0;i<d.length;i++) h+='<div class="cat-item" id="c'+i+'" data-id="'+d[i].category_id+'">'+d[i].category_name+'</div>';
                        document.getElementById('cat-list').innerHTML = h;
                        App.zone=0; App.idx=0; App.updateFocus();
                    }
                });
            },

            loadContent: function() {
                var el = document.getElementById('c'+this.idx); if(!el) return;
                var cid = el.getAttribute('data-id');
                document.querySelectorAll('.cat-item').forEach(function(e){e.classList.remove('active')});
                el.classList.add('active');
                
                document.getElementById('loader').classList.remove('hide');
                document.getElementById('item-list').innerHTML = '';
                
                var act = (this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act+"&category_id="+cid, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) { 
                        App.fullData = d; App.renderList(); 
                        App.zone=2; App.idx=0; App.updateFocus();
                    }
                });
            },

            renderList: function() {
                // LIMITADOR DE RENDERIZAÇÃO: Máximo 50 itens para não travar
                var d = this.fullData;
                var max = d.length > 50 ? 50 : d.length; 
                var h = '';
                for(var i=0; i<max; i++) {
                    var n = d[i].name || d[i].title;
                    h += '<div class="item" id="row-'+i+'">'+n+'</div>';
                }
                if(d.length > 50) h += '<div class="item" style="color:#888; font-style:italic;">...Use a busca para ver mais...</div>';
                document.getElementById('item-list').innerHTML = h;
            },

            doSearch: function() {
                var t = document.getElementById('search').value.toLowerCase();
                if(t.length < 2) return;
                document.getElementById('loader').classList.remove('hide');
                
                var act = (this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        App.fullData = d.filter(function(x){ return (x.name||x.title||"").toLowerCase().indexOf(t) > -1 });
                        App.renderList();
                        App.zone=2; App.idx=0; App.updateFocus();
                    }
                });
            },

            play: function() {
                var item = this.fullData[this.idx];
                var ext = (this.mode==='live')?'ts':(item.container_extension||'mp4');
                var type = (this.mode==='live')?'live':(this.mode==='movie'?'movie':'series');
                var id = item.stream_id || item.series_id;
                
                // Se for série, precisaria de outra lógica, mas para ser leve, vamos focar em TV/Filmes primeiro ou play direto
                if(this.mode === 'series') { alert('Séries simplificadas nesta versão.'); return; }

                var url = this.creds.h+"/"+type+"/"+this.creds.u+"/"+this.creds.p+"/"+id+"."+ext;
                document.getElementById('meta-title').innerText = item.name || item.title;
                document.getElementById('meta-desc').innerText = "Reproduzindo...";
                
                document.querySelectorAll('.item').forEach(function(e){e.classList.remove('playing')});
                var r = document.getElementById('row-'+this.idx); if(r) r.classList.add('playing');
                
                PlayerEngine.play(url);
            },

            toggleFull: function() {
                var b = document.getElementById('vid-box');
                if(b.classList.contains('fs')) b.classList.remove('fs'); else b.classList.add('fs');
            },

            updateFocus: function() {
                document.querySelectorAll('.focused').forEach(function(e){e.classList.remove('focused')});
                var el;
                if(this.scr===0) el=document.getElementById('i'+this.idx);
                if(this.scr===1) el=document.getElementById('m'+this.idx);
                if(this.scr===2) {
                    if(this.zone===0) el=document.getElementById('c'+this.idx);
                    if(this.zone===1) el=document.getElementById('search');
                    if(this.zone===2) el=document.getElementById('row-'+this.idx);
                    if(this.zone===3) el=document.getElementById('vid-box');
                }
                if(el) {
                    el.classList.add('focused');
                    if(el.tagName==='INPUT') el.focus(); else document.activeElement.blur();
                    // SCROLL INSTANTÂNEO (SEM SMOOTH)
                    if(el.tagName!=='INPUT') el.scrollIntoView({block:'center', behavior:'auto'});
                }
            },

            move: function(d) {
                // Lógica de navegação simplificada
                if(this.scr===0) { if(d===1&&this.idx<3) this.idx++; if(d===0&&this.idx>0) this.idx--; }
                if(this.scr===1) { if(d===3&&this.idx<3) this.idx++; if(d===2&&this.idx>0) this.idx--; }
                if(this.scr===2) {
                    if(this.zone===0) { /* Categorias */
                        if(d===1) this.idx++; if(d===0&&this.idx>0) this.idx--; 
                        if(d===3) { this.loadContent(); }
                    } else if(this.zone===2) { /* Lista */
                        if(d===1) this.idx++; if(d===0) { if(this.idx>0) this.idx--; else this.zone=1; }
                        if(d===2) this.zone=0; if(d===3) this.zone=3;
                    } else if(this.zone===1) { /* Busca */
                        if(d===1) { this.zone=2; this.idx=0; } if(d===2) this.zone=0;
                    } else if(this.zone===3) { /* Player */
                        if(d===2) this.zone=2;
                    }
                }
                this.updateFocus();
            },
            
            enter: function() {
                if(this.scr===0) this.login();
                else if(this.scr===1) { if(this.idx===3) this.logout(); else this.openMode(['live','movie','series'][this.idx]); }
                else if(this.scr===2) {
                    if(this.zone===0) this.loadContent();
                    else if(this.zone===1) this.doSearch();
                    else if(this.zone===2) this.play();
                    else if(this.zone===3) this.toggleFull();
                }
            },
            back: function() {
                if(this.scr===2) {
                    if(document.getElementById('vid-box').classList.contains('fs')) { this.toggleFull(); return; }
                    if(this.zone===3||this.zone===2) { this.zone=0; this.idx=0; this.updateFocus(); return; }
                    this.setScr(1);
                }
            }
        };

        document.addEventListener('keydown', function(e) {
            var k=e.keyCode;
            if(document.activeElement.tagName==='INPUT' && k!==13 && k!==40) return;
            e.preventDefault();
            if(k===37) App.move(2); if(k===38) App.move(0);
            if(k===39) App.move(3); if(k===40) App.move(1);
            if(k===13) App.enter();
            if(k===8||k===27||k===461||k===10009) App.back();
        });
    </script>
</body>
</html>
