<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>SKY GOLD - Native Player</title>
    <style>
        /* --- TEMA SKY GOLD (DARK/GOLD) --- */
        :root {
            --gold: #FFD700;
            --gold-dim: #B8860B;
            --bg-deep: #000000;
            --bg-surface: #121212;
            --bg-focus: #F0E68C; /* Dourado claro para foco */
            --text-main: #FFFFFF;
            --text-dim: #888888;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; /* Trava rolagem */
        }

        /* Utilit치rios */
        .hidden { display: none !important; }
        .view {
            width: 100%; height: 100%;
            position: absolute; top: 0; left: 0;
            display: flex; flex-direction: column;
        }

        /* --- CLASSE DE FOCO MANUAL (A M츼GICA DO CONTROLE) --- */
        /* Isso substitui o :hover e :focus nativos que bugam na TV */
        .focused {
            border: 3px solid var(--gold) !important;
            background-color: rgba(255, 215, 0, 0.15) !important;
            transform: scale(1.03);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.6);
            z-index: 10;
        }
        
        /* Ajuste espec칤fico para texto dentro de elemento focado */
        .focused span, .focused i, .focused {
            color: var(--gold) !important;
            font-weight: bold;
        }

        /* --- 1. TELA LOGIN --- */
        #login-view {
            justify-content: center; align-items: center;
            background: radial-gradient(circle, #1a1a1a 0%, #000000 100%);
        }
        .logo { font-size: 4em; font-weight: 900; margin-bottom: 30px; letter-spacing: 5px; }
        .logo span { color: var(--gold); }
        
        .input-box {
            display: flex; flex-direction: column; gap: 15px; width: 350px;
        }
        input {
            padding: 15px; background: #222; border: 2px solid #333;
            color: white; font-size: 1.2em; text-align: center;
        }
        button {
            padding: 15px; background: var(--gold); border: none;
            font-weight: 900; font-size: 1.2em; text-transform: uppercase;
        }

        /* --- 2. TELA HOME --- */
        #home-view {
            flex-direction: row; justify-content: center; align-items: center; gap: 40px;
        }
        .home-card {
            width: 250px; height: 300px;
            background: var(--bg-surface);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            border: 2px solid #333;
            transition: 0.1s;
        }
        .home-card i { font-size: 4em; margin-bottom: 20px; color: #555; }

        /* --- 3. TELA CANAIS (LAYOUT STB) --- */
        #channels-view {
            display: grid;
            grid-template-rows: 60px 1fr;
            grid-template-columns: 280px 1fr;
            height: 100%;
        }

        /* Header */
        .top-bar {
            grid-column: 1 / -1;
            background: #111;
            border-bottom: 2px solid var(--gold);
            display: flex; align-items: center; padding: 0 30px;
            font-size: 1.4em; font-weight: bold;
            color: var(--gold);
        }

        /* Esquerda: Categorias */
        .sidebar {
            background: #080808;
            border-right: 1px solid #333;
            overflow: hidden; /* Rolagem controlada via JS */
            padding-top: 10px;
        }
        .cat-item {
            padding: 15px 20px;
            font-size: 1.1em;
            color: #aaa;
            border-left: 4px solid transparent;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .cat-item.active-cat {
            background-color: #222;
            color: white;
            border-left-color: var(--gold-dim);
        }

        /* Direita: Conte칰do */
        .content-area {
            background: #000;
            padding: 20px;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* Player Preview */
        .preview-window {
            width: 100%; height: 40%;
            background: #000;
            border: 2px solid #333;
            margin-bottom: 15px;
            position: relative;
        }
        video { width: 100%; height: 100%; background: #000; }

        /* Grade de Canais */
        .grid-channels {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Colunas fixas */
            grid-template-rows: repeat(3, 1fr);   /* 3 Linhas fixas vis칤veis */
            gap: 10px;
            overflow: hidden; /* Pagina칞칚o controlada via JS */
        }
        
        .chan-item {
            background: var(--bg-surface);
            border: 2px solid #222;
            display: flex; justify-content: center; align-items: center;
            text-align: center; font-size: 1em; padding: 5px;
            word-break: break-word;
        }

    </style>
</head>
<body>

    <div id="login-view" class="view">
        <div class="logo">SKY <span>GOLD</span></div>
        <div class="input-box">
            <input type="text" id="server" placeholder="URL DNS" value="http://line.sv" class="focusable">
            <input type="text" id="username" placeholder="Usu치rio" class="focusable">
            <input type="password" id="password" placeholder="Senha" class="focusable">
            <button onclick="App.login()" class="focusable">ENTRAR</button>
        </div>
    </div>

    <div id="home-view" class="view hidden">
        <div class="home-card focusable" onclick="App.loadTV()">
            <i>游닠</i>
            <span>AO VIVO</span>
        </div>
        <div class="home-card focusable">
            <i>游꿟</i>
            <span>FILMES</span>
        </div>
        <div class="home-card focusable">
            <i>丘뙖잺</i>
            <span>AJUSTES</span>
        </div>
    </div>

    <div id="channels-view" class="view hidden">
        <div class="top-bar">GUIA DE CANAIS <span style="margin-left:auto; font-size:0.7em" id="clock">00:00</span></div>
        
        <div class="sidebar" id="cat-list-container">
            </div>

        <div class="content-area">
            <div class="preview-window">
                <video id="player" playsinline webkit-playsinline></video>
                <div id="status-msg" style="position:absolute; top:10px; right:10px; color:var(--gold); font-weight:bold;"></div>
            </div>
            <div class="grid-channels" id="chan-grid-container">
                </div>
        </div>
    </div>

    <script>
        /**
         * SISTEMA DE NAVEGA칂츾O ESPACIAL PURO (Sem Mouse)
         * Controla o foco manualmente baseado em matrizes.
         */
        const Nav = {
            index: 0,
            elements: [],
            area: 'login', // login, home, categories, channels
            
            // Atualiza a lista de elementos foc치veis da 치rea atual
            refreshScope: function() {
                if(this.area === 'login') {
                    this.elements = document.querySelectorAll('#login-view .focusable');
                } else if(this.area === 'home') {
                    this.elements = document.querySelectorAll('#home-view .focusable');
                } else if(this.area === 'categories') {
                    this.elements = document.querySelectorAll('#cat-list-container .cat-item');
                } else if(this.area === 'channels') {
                    this.elements = document.querySelectorAll('#chan-grid-container .chan-item');
                }
                
                // Remove foco antigo e reseta
                document.querySelectorAll('.focused').forEach(el => el.classList.remove('focused'));
                if(this.elements.length > 0) {
                    if(this.index >= this.elements.length) this.index = 0;
                    this.elements[this.index].classList.add('focused');
                    this.elements[this.index].scrollIntoView({block: "center", behavior: "smooth"});
                }
            },

            move: function(dir) {
                if(this.elements.length === 0) return;

                const cols = 4; // Colunas na grade de canais

                // L칩gica de Movimento por 츼rea
                if (this.area === 'channels') {
                    if(dir === 'right') {
                        if((this.index + 1) % cols !== 0 && this.index < this.elements.length - 1) this.index++;
                    } else if(dir === 'left') {
                        if(this.index % cols === 0) {
                            // Borda esquerda da grade: Voltar para Categorias
                            this.area = 'categories';
                            this.refreshScope();
                            return; 
                        } else {
                            this.index--;
                        }
                    } else if(dir === 'down') {
                         if(this.index + cols < this.elements.length) this.index += cols;
                    } else if(dir === 'up') {
                         if(this.index - cols >= 0) this.index -= cols;
                    }
                } 
                else if (this.area === 'categories') {
                    if(dir === 'down') {
                        if(this.index < this.elements.length - 1) this.index++;
                    } else if(dir === 'up') {
                        if(this.index > 0) this.index--;
                    } else if(dir === 'right') {
                        // Ir para canais
                        this.area = 'channels';
                        this.index = 0; // Foca no primeiro canal
                        this.refreshScope();
                        return;
                    }
                }
                else {
                    // Login e Home (Linear simples)
                    if(dir === 'down' || dir === 'right') {
                        if(this.index < this.elements.length - 1) this.index++;
                    } else if(dir === 'up' || dir === 'left') {
                        if(this.index > 0) this.index--;
                    }
                }

                // Aplica o foco visual
                document.querySelectorAll('.focused').forEach(el => el.classList.remove('focused'));
                this.elements[this.index].classList.add('focused');
                
                // Scroll manual para garantir visibilidade
                this.elements[this.index].scrollIntoView({block: "nearest", behavior: "smooth"});

                // Se estiver nas categorias, carrega os canais automaticamente ao focar (opcional, estilo STB)
                if(this.area === 'categories') {
                    App.loadChannelsForCategory(this.index);
                }
            },

            enter: function() {
                const el = this.elements[this.index];
                if(el) el.click();
            }
        };

        /**
         * L칍GICA DO APP
         */
        const App = {
            creds: { url: '', user: '', pass: '' },
            categories: [], 
            
            login: function() {
                this.creds.url = document.getElementById('server').value;
                this.creds.user = document.getElementById('username').value;
                this.creds.pass = document.getElementById('password').value;
                
                // MOCK DATA PARA TESTE
                this.mockLoad();
                
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('home-view').classList.remove('hidden');
                
                Nav.area = 'home';
                Nav.index = 0;
                Nav.refreshScope();
            },

            mockLoad: function() {
                // Simula 10 Categorias
                this.categories = [];
                for(let i=0; i<10; i++) {
                    let chans = [];
                    // Simula 50 canais por categoria
                    for(let c=0; c<50; c++) {
                        chans.push({ 
                            name: `SKY Canal ${i}-${c}`, 
                            id: c,
                            // URL TS direta (formato Xtream padr칚o)
                            // A TV entende melhor .ts do que .m3u8 em alguns casos
                            url: `http://mock/${i}/${c}.ts` 
                        });
                    }
                    this.categories.push({ name: `Categoria ${i}`, channels: chans });
                }
            },

            loadTV: function() {
                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('channels-view').classList.remove('hidden');
                
                // Renderizar Sidebar
                const catContainer = document.getElementById('cat-list-container');
                catContainer.innerHTML = '';
                this.categories.forEach((cat, idx) => {
                    const div = document.createElement('div');
                    div.className = 'cat-item';
                    div.innerText = cat.name;
                    // Ao clicar (Enter), apenas define foco, a carga 칠 no movimento
                    div.onclick = () => {
                        Nav.area = 'channels';
                        Nav.index = 0;
                        Nav.refreshScope();
                    }; 
                    catContainer.appendChild(div);
                });

                // Inicia nas categorias
                Nav.area = 'categories';
                Nav.index = 0;
                Nav.refreshScope();
                this.loadChannelsForCategory(0);
            },

            loadChannelsForCategory: function(catIndex) {
                // Marca visualmente a categoria ativa
                document.querySelectorAll('.cat-item').forEach(el => el.classList.remove('active-cat'));
                document.querySelectorAll('.cat-item')[catIndex].classList.add('active-cat');

                const chanContainer = document.getElementById('chan-grid-container');
                chanContainer.innerHTML = '';
                
                const channels = this.categories[catIndex].channels;
                
                channels.forEach(chan => {
                    const div = document.createElement('div');
                    div.className = 'chan-item';
                    div.innerText = chan.name;
                    div.onclick = () => this.playChannel(chan.url);
                    chanContainer.appendChild(div);
                });

                // Se o foco j치 estava nos canais, atualiza a lista de elementos naveg치veis
                if(Nav.area === 'channels') {
                    Nav.refreshScope();
                }
            },

            playChannel: function(url) {
                const player = document.getElementById('player');
                const status = document.getElementById('status-msg');
                
                // MONTAGEM DA URL XTREAM CODES REAL (TS HARDWARE)
                // Se fosse real: `${this.creds.url}/live/${this.creds.user}/${this.creds.pass}/${streamID}.ts`
                
                // Usando BigBuckBunny para teste
                const realUrl = "http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";

                // L칩gica de 2 Cliques
                if(player.src === realUrl && !player.paused) {
                    // SEGUNDO CLIQUE: TELA CHEIA
                    if(player.requestFullscreen) player.requestFullscreen();
                    else if(player.webkitRequestFullscreen) player.webkitRequestFullscreen();
                } else {
                    // PRIMEIRO CLIQUE: PLAY NO PREVIEW
                    status.innerText = "CONECTANDO...";
                    player.src = realUrl;
                    player.play().then(() => {
                        status.innerText = "";
                    }).catch(e => {
                        status.innerText = "ERRO STREAM";
                    });
                }
            }
        };

        /**
         * CONTROLE REMOTO (EVENT LISTENERS)
         */
        document.addEventListener('keydown', function(e) {
            e.preventDefault(); // Impede comportamento padr칚o do navegador
            
            const key = e.keyCode;
            
            if(key === 37) Nav.move('left');
            else if(key === 38) Nav.move('up');
            else if(key === 39) Nav.move('right');
            else if(key === 40) Nav.move('down');
            else if(key === 13) Nav.enter(); // OK/ENTER
            
            // Voltar (Back/Return/Esc)
            else if([461, 8, 10009, 27].includes(key)) {
                if(Nav.area === 'channels') {
                    // Volta para categorias
                    Nav.area = 'categories';
                    Nav.refreshScope();
                } else if(Nav.area === 'categories') {
                    // Volta para Home
                    document.getElementById('channels-view').classList.add('hidden');
                    document.getElementById('home-view').classList.remove('hidden');
                    // Para o player
                    document.getElementById('player').pause();
                    document.getElementById('player').src = "";
                    
                    Nav.area = 'home';
                    Nav.refreshScope();
                }
            }
        });

        // Rel칩gio
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = 
                now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        }, 1000);

        // Init
        window.onload = () => {
            Nav.area = 'login';
            Nav.refreshScope();
        };

    </script>
</body>
</html>
