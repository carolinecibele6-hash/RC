<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV GOLD | SMARTERS PRO</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* --- TEMA DARK/GOLD SMARTERS --- */
        :root {
            --bg: #0a0a0a;
            --gold: #d4af37;
            --gold-light: #ffd700;
            --panel: #141414;
            --focus: linear-gradient(90deg, #d4af37 0%, #f9d423 100%);
            --text-gray: #aaa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }

        body {
            background-color: var(--bg);
            color: #fff;
            font-family: 'Montserrat', sans-serif, Arial;
            width: 100vw; height: 100vh; overflow: hidden;
            /* Fundo abstrato premium escuro */
            background-image: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://img.freepik.com/free-vector/gradient-black-background-with-golden-textures_23-2149150493.jpg');
            background-size: cover;
        }

        .hide { display: none !important; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: #000; }
        .flex-center { display: flex; align-items: center; justify-content: center; }

        /* --- FOCO SMARTERS (Branco/Dourado) --- */
        .focusable { cursor: pointer; transition: transform 0.1s; border: 2px solid transparent; }
        
        .focused {
            border: 2px solid #fff !important;
            background: var(--focus) !important;
            color: #000 !important;
            transform: scale(1.02);
            z-index: 100;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
            font-weight: 800 !important;
        }
        .focused * { color: #000 !important; }
        .focused img { border: 1px solid #000; }

        /* --- LOGIN --- */
        #login-layer { background: url('https://img.freepik.com/free-vector/gradient-black-background-with-golden-textures_23-2149150493.jpg') no-repeat center; background-size: cover; }
        .login-overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); }
        
        .login-box { 
            position: relative; width: 400px; padding: 40px; 
            background: rgba(20, 20, 20, 0.95); border-radius: 15px; 
            border: 1px solid #333; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .logo-txt { font-size: 36px; font-weight: 900; color: #fff; margin-bottom: 5px; }
        .logo-txt span { color: var(--gold); }
        .inp { width: 100%; padding: 15px; margin: 10px 0; background: #000; border: 1px solid #333; color: var(--gold); text-align: center; font-weight: bold; border-radius: 5px; }
        .btn-login { width: 100%; padding: 15px; margin-top: 20px; background: var(--gold); color: #000; font-weight: 900; border: none; border-radius: 5px; font-size: 16px; }

        /* --- DASHBOARD (HOME) --- */
        #dash-layer { padding: 40px; display: flex; flex-direction: column; justify-content: space-between; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 1px solid #333; }
        .user-pill { background: #222; padding: 10px 20px; border-radius: 30px; font-size: 12px; color: var(--gold); border: 1px solid #333; }
        .time-big { font-size: 40px; font-weight: 300; }

        .menu-grid { display: flex; gap: 30px; height: 50vh; align-items: center; justify-content: center; }
        .menu-card { 
            width: 25%; height: 100%; 
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 1px solid #333; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .menu-card i { font-size: 60px; margin-bottom: 20px; color: #555; }
        .menu-card span { font-size: 18px; font-weight: 800; text-transform: uppercase; color: #ddd; }

        .menu-card.live { border-bottom: 4px solid #d4af37; }
        .menu-card.movie { border-bottom: 4px solid #d43737; }
        .menu-card.series { border-bottom: 4px solid #377ad4; }
        .menu-card.settings { border-bottom: 4px solid #888; }

        /* --- LAYOUT INTERNO (SMARTERS) --- */
        #content-layer { display: flex; background: #000; }
        
        /* Sidebar (Categorias) */
        .sidebar { width: 25%; background: #0f0f0f; display: flex; flex-direction: column; border-right: 1px solid #222; }
        .sidebar-head { padding: 20px; background: #080808; text-align: center; font-weight: 900; color: var(--gold); border-bottom: 2px solid var(--gold); font-size: 18px; }
        .cat-list { flex: 1; overflow-y: auto; }
        .cat-item { padding: 15px 20px; border-bottom: 1px solid #1a1a1a; font-size: 13px; font-weight: 600; color: #888; }
        .cat-item.active { background: #1a1a1a; color: #fff; border-left: 5px solid var(--gold); }

        /* Main Content (Lista ou Grade) */
        .main-area { flex: 1; display: flex; flex-direction: column; background: #050505; }
        .top-tools { height: 60px; background: #080808; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid #222; }
        .search-bar { width: 100%; background: #151515; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 5px; text-align: center; }
        
        .content-list { flex: 1; overflow-y: auto; padding: 20px; }

        /* Layout LISTA (Canais) */
        .list-view .item { 
            padding: 15px; margin-bottom: 5px; background: #111; 
            border-radius: 5px; font-size: 14px; font-weight: 600; color: #ccc;
            display: flex; justify-content: space-between;
        }
        .list-view .item.focused { background: var(--gold); color: #000; }

        /* Layout GRADE (Filmes/Series) */
        .grid-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .poster { 
            height: 200px; background: #111; border-radius: 8px; overflow: hidden; 
            position: relative; border: 1px solid #333;
        }
        .poster img { width: 100%; height: 100%; object-fit: cover; }
        .poster-title { 
            position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.9); 
            color: #fff; font-size: 10px; padding: 5px; text-align: center; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* --- INFO SÉRIE (PEDIDO: EPISÓDIOS EM TEXTO) --- */
        #series-layer { display: flex; background: #050505; padding: 40px; }
        .serie-left { width: 250px; flex-shrink: 0; text-align: center; }
        .serie-cover { width: 100%; height: 350px; object-fit: cover; border: 3px solid var(--gold); border-radius: 10px; }
        .serie-title { margin-top: 15px; font-size: 22px; font-weight: 900; color: var(--gold); }
        
        .serie-right { flex: 1; margin-left: 40px; display: flex; flex-direction: column; }
        .ep-header { font-size: 16px; color: #fff; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .ep-list { flex: 1; overflow-y: auto; background: #111; padding: 10px; border-radius: 10px; border: 1px solid #333; }
        .ep-row { padding: 12px; border-bottom: 1px solid #222; font-size: 13px; color: #aaa; cursor: pointer; }
        .ep-row:last-child { border: none; }
        .ep-row.focused { background: var(--gold); color: #000; font-weight: 800; border-radius: 4px; }

        /* --- PLAYER --- */
        #player-layer { background: #000; }
        video { width: 100%; height: 100%; }
        .osd { position: absolute; top: 20px; right: 20px; background: rgba(212, 175, 55, 0.2); color: var(--gold); padding: 5px 15px; border: 1px solid var(--gold); font-weight: bold; display:none;}

        /* Loader */
        #loader { background: #000; z-index: 20000; flex-direction: column; color: var(--gold); }
        .load-spin { font-size: 50px; margin-bottom: 20px; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="layer hide flex-center">
        <i class="fas fa-circle-notch fa-spin load-spin"></i>
        <div style="font-weight:900; letter-spacing:2px">CARREGANDO...</div>
    </div>

    <div id="login-layer" class="layer flex-center">
        <div class="login-overlay"></div>
        <div class="login-box">
            <div class="logo-txt">IPTV <span>GOLD</span></div>
            <div style="font-size:10px; color:#aaa; margin-bottom:20px; letter-spacing:3px;">SMARTERS EDITION</div>
            
            <input type="text" id="i0" class="inp focusable" placeholder="http://url-do-servidor:porta" autocomplete="off">
            <input type="text" id="i1" class="inp focusable" placeholder="USUÁRIO" autocomplete="off">
            <input type="password" id="i2" class="inp focusable" placeholder="SENHA" autocomplete="off">
            
            <button id="i3" class="btn-login focusable" onclick="App.tryLogin()">ENTRAR</button>
            <div id="msg-login" style="color:#ff4444; margin-top:15px; font-size:12px; font-weight:bold;"></div>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="header">
            <div class="user-pill"><i class="fas fa-user-circle"></i> <span id="user-display">USUÁRIO</span></div>
            <div class="logo-txt" style="font-size:24px">GOLD <span>TV</span></div>
            <div class="time-big" id="clock">00:00</div>
        </div>

        <div class="menu-grid">
            <div id="m0" class="menu-card live focusable" onclick="App.open('live')">
                <i class="fas fa-tv"></i><span>TV Ao Vivo</span>
            </div>
            <div id="m1" class="menu-card movie focusable" onclick="App.open('movie')">
                <i class="fas fa-film"></i><span>Filmes</span>
            </div>
            <div id="m2" class="menu-card series focusable" onclick="App.open('series')">
                <i class="fas fa-layer-group"></i><span>Séries</span>
            </div>
            <div id="m3" class="menu-card settings focusable" onclick="App.logout()">
                <i class="fas fa-sign-out-alt"></i><span>Sair</span>
            </div>
        </div>
        
        <div style="text-align:center; font-size:12px; color:#555;">IPTV GOLD v9.0 - PHILCO EDITION</div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="sidebar">
            <div class="sidebar-head">CATEGORIAS</div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="main-area">
            <div class="top-tools">
                <input type="text" id="search" class="search-bar focusable" placeholder="DIGITE PARA BUSCAR..." onkeyup="App.searchLocal()">
            </div>
            <div id="content-area" class="content-list list-view"></div>
        </div>
    </div>

    <div id="series-layer" class="layer hide">
        <div class="serie-left">
            <img id="ser-poster" class="serie-cover" src="">
        </div>
        <div class="serie-right">
            <div id="ser-title" class="serie-title">...</div>
            <div class="ep-header">LISTA DE EPISÓDIOS</div>
            <div id="ep-list" class="ep-list"></div>
        </div>
    </div>

    <div id="player-layer" class="layer hide">
        <div id="osd" class="osd"></div>
        <video id="player" controls style="width:100%;height:100%;background:#000"></video>
    </div>

    <script>
        // --- ENGINE ---
        var Player = {
            hls: null, video: null,
            init: function() {
                this.video = document.getElementById('player');
                this.video.onerror = function() { 
                    // Tratamento silencioso de erro para não travar
                    console.log("Erro Play"); 
                };
            },
            play: function(url) {
                if(this.hls) { this.hls.destroy(); this.hls=null; }
                
                // Força m3u8 se for live TS (mais leve)
                if(url.includes('/live/') && url.includes('.ts')) url = url.replace('.ts', '.m3u8');

                if(Hls.isSupported()) {
                    var config = { maxBufferLength: 10, manifestLoadingTimeOut: 10000 };
                    this.hls = new Hls(config);
                    this.hls.loadSource(url);
                    this.hls.attachMedia(this.video);
                    this.hls.on(Hls.Events.MANIFEST_PARSED, function() { Player.video.play(); });
                } else {
                    this.video.src = url;
                    this.video.play();
                }
            },
            stop: function() {
                if(this.hls) this.hls.destroy();
                this.video.pause();
                this.video.removeAttribute('src');
                this.video.load();
            }
        };

        var App = {
            scr: 0, idx: 0, creds: {}, data: [], filterData: [], mode: '',
            
            init: function() {
                Player.init();
                if(localStorage.getItem('gh')) {
                    document.getElementById('i0').value = localStorage.getItem('gh');
                    document.getElementById('i1').value = localStorage.getItem('gu');
                    document.getElementById('i2').value = localStorage.getItem('gp');
                }
                this.clock();
                this.focusFirst();
            },

            clock: function() {
                setInterval(() => {
                    var d = new Date();
                    document.getElementById('clock').innerText = d.getHours() + ":" + (d.getMinutes()<10?'0':'') + d.getMinutes();
                }, 1000);
            },

            // Login com Fallback (Se falhar direto, tenta proxy)
            tryLogin: function() {
                var h = document.getElementById('i0').value.trim();
                var u = document.getElementById('i1').value.trim();
                var p = document.getElementById('i2').value.trim();
                
                if(!h || !u || !p) { document.getElementById('msg-login').innerText = "Preencha tudo!"; return; }
                if(h.endsWith('/')) h = h.slice(0, -1);
                if(h.indexOf('http') === -1) h = 'http://' + h;

                document.getElementById('loader').classList.remove('hide');
                document.getElementById('msg-login').innerText = "";

                // Tenta Direto
                var api = `${h}/player_api.php?username=${u}&password=${p}`;
                this.req(api, function(d) {
                    if(d && d.user_info) {
                        App.successLogin(d, h, u, p);
                    } else {
                        // Se falhar, tenta via Proxy Público (AllOrigins)
                        console.log("Tentando Proxy...");
                        var proxyApi = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(api);
                        App.req(proxyApi, function(d2) {
                            if(d2 && d2.user_info) {
                                App.successLogin(d2, h, u, p);
                            } else {
                                document.getElementById('loader').classList.add('hide');
                                document.getElementById('msg-login').innerText = "Erro de Conexão ou Dados Inválidos.";
                            }
                        });
                    }
                });
            },

            req: function(url, cb) {
                var x = new XMLHttpRequest();
                x.open("GET", url, true);
                x.timeout = 10000;
                x.onload = function() { try { cb(JSON.parse(x.responseText)); } catch(e) { cb(null); } };
                x.onerror = function() { cb(null); };
                x.send();
            },

            successLogin: function(d, h, u, p) {
                document.getElementById('loader').classList.add('hide');
                if(d.user_info.auth == 0) {
                    document.getElementById('msg-login').innerText = "Conta Vencida ou Inválida.";
                    return;
                }
                this.creds = {h:h, u:u, p:p};
                localStorage.setItem('gh', h); localStorage.setItem('gu', u); localStorage.setItem('gp', p);
                document.getElementById('user-display').innerText = d.user_info.username;
                this.setScr(1);
            },

            logout: function() { localStorage.clear(); location.reload(); },

            setScr: function(n) {
                Player.stop();
                document.querySelectorAll('.layer').forEach(e => e.classList.add('hide'));
                if(n===0) document.getElementById('login-layer').classList.remove('hide');
                if(n===1) document.getElementById('dash-layer').classList.remove('hide');
                if(n===2) document.getElementById('content-layer').classList.remove('hide');
                if(n===3) document.getElementById('player-layer').classList.remove('hide');
                if(n===4) document.getElementById('series-layer').classList.remove('hide');
                this.scr = n;
                setTimeout(() => this.focusFirst(), 100);
            },

            open: function(m) {
                this.mode = m;
                this.setScr(2);
                document.getElementById('cat-list').innerHTML = '';
                document.getElementById('content-area').innerHTML = '';
                document.getElementById('loader').classList.remove('hide');

                var act = (m==='live') ? 'get_live_categories' : (m==='movie'?'get_vod_categories':'get_series_categories');
                // Usa proxy fallback na API também se necessário, mas vamos direto por enquanto
                var url = `${this.creds.h}/player_api.php?username=${this.creds.u}&password=${this.creds.p}&action=${act}`;
                
                this.req(url, function(d) {
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        var h = '';
                        for(var i=0; i<d.length; i++) {
                            h += `<div class="cat-item focusable" tabindex="0" onclick="App.loadCat('${d[i].category_id}', this)">${d[i].category_name}</div>`;
                        }
                        document.getElementById('cat-list').innerHTML = h;
                        var f = document.querySelector('.cat-item'); if(f) f.focus();
                    }
                });
            },

            loadCat: function(cid, el) {
                if(el) {
                    document.querySelectorAll('.cat-item').forEach(e=>e.classList.remove('active'));
                    el.classList.add('active');
                }
                document.getElementById('loader').classList.remove('hide');
                
                var act = (this.mode==='live') ? 'get_live_streams' : (this.mode==='movie'?'get_vod_streams':'get_series');
                var url = `${this.creds.h}/player_api.php?username=${this.creds.u}&password=${this.creds.p}&action=${act}&category_id=${cid}`;

                this.req(url, function(d) {
                    document.getElementById('loader').classList.add('hide');
                    App.data = d || [];
                    App.filterData = App.data; // Reset filtro
                    App.renderList();
                });
            },

            // Renderiza com visual apropriado
            renderList: function() {
                var el = document.getElementById('content-area');
                el.innerHTML = '';
                
                // Configura Classe (Grid ou List)
                if(this.mode === 'live') {
                    el.className = 'content-list list-view';
                } else {
                    el.className = 'content-list grid-view';
                }

                var d = this.filterData;
                var max = d.length > 100 ? 100 : d.length; // Limite Philco
                
                var html = '';
                for(var i=0; i<max; i++) {
                    var item = d[i];
                    var name = item.name || item.title;
                    var img = item.stream_icon || item.cover;
                    
                    if(this.mode === 'live') {
                        html += `<div class="item focusable" tabindex="0" onclick="App.clickItem(${i})">${name} <i class="fas fa-play"></i></div>`;
                    } else {
                        if(!img || img.length < 5) img = 'https://via.placeholder.com/150x220?text=GOLD';
                        html += `<div class="poster focusable" tabindex="0" onclick="App.clickItem(${i})">
                                    <img src="${img}" onerror="this.src='https://via.placeholder.com/150x220?text=ERRO'">
                                    <div class="poster-title">${name}</div>
                                 </div>`;
                    }
                }
                el.innerHTML = html;
            },

            // Busca Instantânea Local (Não trava TV)
            searchLocal: function() {
                var term = document.getElementById('search').value.toLowerCase();
                if(term.length < 2) {
                    this.filterData = this.data;
                } else {
                    this.filterData = this.data.filter(item => (item.name || item.title).toLowerCase().includes(term));
                }
                this.renderList();
            },

            clickItem: function(idx) {
                var item = this.filterData[idx];
                
                if(this.mode === 'series') {
                    this.loadSeries(item);
                } else {
                    var type = (this.mode === 'live') ? 'live' : 'movie';
                    var ext = item.container_extension || 'mp4';
                    var url = `${this.creds.h}/${type}/${this.creds.u}/${this.creds.p}/${item.stream_id}.${ext}`;
                    
                    this.setScr(3);
                    Player.play(url);
                }
            },

            loadSeries: function(item) {
                this.setScr(4);
                document.getElementById('ser-title').innerText = item.name;
                document.getElementById('ser-poster').src = item.cover || '';
                document.getElementById('ep-list').innerHTML = '<div style="padding:20px">Carregando episódios...</div>';

                var url = `${this.creds.h}/player_api.php?username=${this.creds.u}&password=${this.creds.p}&action=get_series_info&series_id=${item.series_id}`;
                
                this.req(url, function(d) {
                    if(d && d.episodes) {
                        var h = '';
                        for(var k in d.episodes) {
                            var eps = d.episodes[k];
                            for(var j=0; j<eps.length; j++) {
                                var ep = eps[j];
                                var ext = ep.container_extension || 'mp4';
                                h += `<div class="ep-row focusable" tabindex="0" onclick="App.playEp('${ep.id}', '${ext}')">
                                        ${ep.title}
                                      </div>`;
                            }
                        }
                        document.getElementById('ep-list').innerHTML = h;
                        var f = document.querySelector('.ep-row'); if(f) f.focus();
                    }
                });
            },

            playEp: function(id, ext) {
                var url = `${this.creds.h}/series/${this.creds.u}/${this.creds.p}/${id}.${ext}`;
                this.setScr(3);
                Player.play(url);
            },

            focusFirst: function() {
                var el = document.querySelector('.focusable');
                if(el) el.focus();
            }
        };

        // --- CONTROLE REMOTO ---
        document.addEventListener('keydown', function(e) {
            var k = e.keyCode;
            // Back (8), Escape (27), Return (461), Exit (10009)
            if(k===8 || k===27 || k===461 || k===10009) {
                e.preventDefault();
                if(App.scr === 3) App.setScr(2); // Player -> Lista
                else if(App.scr === 4) App.setScr(2); // Serie -> Lista
                else if(App.scr === 2) App.setScr(1); // Lista -> Home
                else if(App.scr === 1) App.setScr(0); // Home -> Login
            }
            
            // Enter em Inputs
            if(k===13 && document.activeElement.tagName === 'INPUT') {
                if(App.scr===0) App.tryLogin();
            }
        });

        // Adiciona classe focused manualmente (Correção CSS :focus)
        document.addEventListener('focusin', e => e.target.classList.add('focused'));
        document.addEventListener('focusout', e => e.target.classList.remove('focused'));

    </script>
</body>
</html>
