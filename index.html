<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R&C GOLD ULTRA</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* --- PERFORMANCE MÁXIMA PARA TV PHILCO --- */
        :root { 
            --bg: #000000; 
            --gold: #FFD700; 
            --dark-gold: #B8860B;
            --surface: #141414;
            --highlight: #333;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        /* Aceleração de Hardware Global */
        body {
            background-color: var(--bg); 
            color: #e0e0e0;
            font-family: 'Montserrat', sans-serif;
            width: 100vw; height: 100vh; overflow: hidden;
            /* Removemos gradientes pesados do fundo */
        }

        /* Classes Utilitárias */
        .hide { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: #000; }

        /* CURSOR E INTERATIVIDADE */
        button, .smart-card, .cat-item, .item, .power-btn, .key { cursor: pointer; }
        
        /* SCROLLBAR ESCONDIDA MAS FUNCIONAL PARA MOUSE */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* --- SISTEMA DE FOCO HÍBRIDO (CONTROLE + MOUSE) --- */
        /* Design Flat para Performance - Sem Sombras pesadas */
        .focused {
            border: 3px solid var(--gold) !important;
            background: #2a2a2a !important;
            color: #fff !important;
            transform: scale(1.02); /* Scale pequeno para não travar a GPU */
            z-index: 50;
        }
        
        /* Efeito Hover do Mouse (Igual ao Focused) */
        .smart-card:hover, .cat-item:hover, .item:hover, .btn:hover {
            border: 2px solid var(--gold);
            background: #222;
        }

        /* --- LOGIN --- */
        .login-box { 
            width: 400px; max-width: 90%; padding: 40px; 
            background: var(--surface); border: 1px solid #333; 
            border-radius: 8px; text-align: center; 
        }
        .logo-txt { font-size: 32px; font-weight: 900; letter-spacing: -1px; color:#fff; margin-bottom: 20px;}
        .logo-txt span { color: var(--gold); }
        .inp { 
            width: 100%; padding: 15px; margin: 8px 0; 
            background: #000; border: 2px solid #333; color: #fff; 
            text-align: center; font-weight: bold; border-radius: 4px; 
            font-size: 16px; transition: border 0.2s;
        }
        .inp:focus { border-color: var(--gold); }
        .btn { 
            width: 100%; padding: 15px; margin-top: 20px; 
            background: var(--gold); color: #000; border: none; 
            text-transform: uppercase; font-weight: 900; border-radius: 4px; font-size: 18px;
        }

        /* --- DASHBOARD (MENU PRINCIPAL) --- */
        #dash-layer { display: flex; flex-direction: column; padding: 30px; justify-content: space-between; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .dash-logo { font-size: 30px; font-weight: 900; }
        .dash-logo span { color: var(--gold); }
        
        .dash-grid { display: flex; gap: 30px; justify-content: center; align-items: center; flex: 1; }
        
        .smart-card { 
            width: 220px; height: 260px;
            background: var(--surface);
            border: 2px solid #222;
            border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.1s; /* Rápido */
        }
        .smart-card i { font-size: 60px; margin-bottom: 20px; color: #666; }
        .smart-card span { font-size: 18px; font-weight: 800; text-transform: uppercase; color: #ddd; }
        .smart-card.focused i, .smart-card:hover i { color: var(--gold); }

        /* --- CONTEÚDO (LAYOUT ESTILO SKY/NETFLIX) --- */
        #content-layer { display: flex; }
        
        /* Coluna Categorias */
        .col-cat { width: 22%; background: #0a0a0a; border-right: 1px solid #222; display: flex; flex-direction: column; height: 100vh;}
        .cat-head { padding: 15px; background: #000; color: var(--gold); font-weight: 900; text-align: center; font-size: 14px; border-bottom: 1px solid #222; }
        .cat-list { flex: 1; overflow-y: auto; overflow-x: hidden; }
        .cat-item { 
            padding: 12px 20px; border-bottom: 1px solid #111; color: #888; 
            font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
        }
        .cat-item.active { border-left: 4px solid var(--gold); background: #1a1a1a; color: #fff; }

        /* Coluna Lista de Canais */
        .col-list { width: 28%; background: var(--surface); border-right: 1px solid #222; display: flex; flex-direction: column; height: 100vh; }
        .search-area { padding: 10px; background: #000; }
        .inp-search { width: 100%; background: #222; border: none; color: #fff; padding: 10px; text-align: center; font-weight: bold; border-radius: 4px; }
        .item-list { flex: 1; overflow-y: auto; overflow-x: hidden; }
        .item { 
            padding: 14px 20px; border-bottom: 1px solid #222; color: #bbb; 
            font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
        }
        .item.playing { color: var(--gold); background: #222; font-weight: bold; }
        .fav-icon { float: right; color: var(--gold); }

        /* Área do Player */
        .col-play { flex: 1; background: #000; display: flex; flex-direction: column; position: relative; height: 100vh; }
        
        .vid-box { 
            width: 100%; height: 55%; background: #000; position: relative; 
            /* Importante para Philco: */
            transform: translateZ(0); 
        }
        
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        
        .meta { padding: 20px; flex: 1; background: #050505; overflow-y: auto; }
        .meta-title { font-size: 22px; color: #fff; font-weight: 800; margin-bottom: 5px; }
        .meta-epg { font-size: 12px; color: var(--gold); margin-bottom: 10px; display: block; font-weight: bold; }
        .meta-desc { font-size: 13px; color: #666; line-height: 1.4; }

        /* Fullscreen */
        #vid-box.fs {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999; border: none;
        }

        #loader { background: rgba(0,0,0,0.9); z-index: 20000; flex-direction: column; color: var(--gold); font-weight: 900; }
        .osd-status { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: #fff; padding: 5px 15px; border-radius: 4px; font-weight: bold; display: none; z-index: 10000; }

        /* Responsividade para Air Mouse (Botões maiores em telas pequenas não se aplica aqui pois é TV, mas ajuda na mira) */
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="hide flex-center">
        <i class="fas fa-circle-notch fa-spin" style="font-size:40px; margin-bottom:15px"></i>
        <div id="load-txt">INICIANDO SISTEMA...</div>
    </div>

    <div id="login-layer" class="layer flex-center">
        <div class="login-box">
            <div class="logo-txt">R&C <span>GOLD</span></div>
            <input type="text" id="i0" class="inp" placeholder="URL DNS" onmouseenter="App.mouseFocus(0,0)">
            <input type="text" id="i1" class="inp" placeholder="USUÁRIO" onmouseenter="App.mouseFocus(0,1)">
            <input type="password" id="i2" class="inp" placeholder="SENHA" onmouseenter="App.mouseFocus(0,2)">
            <button id="i3" class="btn" onclick="App.login()" onmouseenter="App.mouseFocus(0,3)">ENTRAR AGORA</button>
            <div id="msg-login" style="color:#ff5555; margin-top:10px; font-size:12px;"></div>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="top-bar">
            <div class="dash-logo">R&C <span>GOLD</span></div>
            <div style="text-align:right">
                <div id="clock-time" style="font-size:24px; font-weight:bold">00:00</div>
                <div id="info-exp" style="font-size:12px; color:#888">...</div>
            </div>
        </div>

        <div class="dash-grid">
            <div id="m0" class="smart-card" onclick="App.openMode('live')" onmouseenter="App.mouseFocus(1,0)">
                <i class="fas fa-tv"></i><span>TV AO VIVO</span>
            </div>
            <div id="m1" class="smart-card" onclick="App.openMode('movie')" onmouseenter="App.mouseFocus(1,1)">
                <i class="fas fa-film"></i><span>FILMES</span>
            </div>
            <div id="m2" class="smart-card" onclick="App.openMode('series')" onmouseenter="App.mouseFocus(1,2)">
                <i class="fas fa-video"></i><span>SÉRIES</span>
            </div>
        </div>

        <div style="text-align:center">
            <div id="m3" class="btn" style="width:auto; padding:10px 30px; background:#333; display:inline-block;" onclick="App.logout()" onmouseenter="App.mouseFocus(1,3)">
                <i class="fas fa-power-off"></i> SAIR
            </div>
        </div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="col-cat">
            <div class="cat-head">CATEGORIAS</div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="col-list">
            <div class="search-area">
                <input type="text" id="search" class="inp-search" placeholder="BUSCAR..." onmouseenter="App.mouseFocus(2, -1, 1)"> </div>
            <div id="item-list" class="item-list"></div>
        </div>
        <div class="col-play">
            <div id="vid-box" class="vid-box" onclick="App.toggleFull()" onmouseenter="App.mouseFocus(2, -1, 3)">
                <video id="player" playsinline webkit-playsinline></video>
                <div id="osd" class="osd-status"></div>
            </div>
            <div class="meta">
                <div id="meta-title" class="meta-title">R&C GOLD</div>
                <div id="meta-epg" class="meta-epg hide"></div>
                <div id="meta-desc" class="meta-desc">Use o Air Mouse ou as setas para navegar.</div>
            </div>
        </div>
    </div>

    <script>
        // --- GERENCIADOR DE FAVORITOS OTIMIZADO ---
        var FavManager = {
            key: 'rc_favs_v2', list: [],
            init: function() { try{ var s=localStorage.getItem(this.key); this.list=s?JSON.parse(s):[]; }catch(e){this.list=[];} },
            toggle: function(id) {
                var idx = this.list.indexOf(id);
                if(idx > -1) this.list.splice(idx, 1); else this.list.push(id);
                localStorage.setItem(this.key, JSON.stringify(this.list));
                if(App.idx < App.fullData.length) App.renderList(true);
            },
            isFav: function(id) { return this.list.indexOf(id) > -1; }
        };

        // --- ENGINE DO PLAYER (TURBO HLS) ---
        var PlayerEngine = {
            hls: null, video: null, url: null, 
            init: function() { this.video = document.getElementById('player'); },
            play: function(url, isLive) {
                if(this.url === url && !this.video.paused) return;
                this.destroy(); 
                this.url = url; 
                
                if(isLive && url.indexOf('.m3u8') === -1 && url.indexOf('.ts') > -1) url = url.replace('.ts', '.m3u8');

                // Configuração HLS leve para TV Philco
                if(Hls.isSupported()) {
                    var config = { 
                        enableWorker: true, // Usa WebWorker se disponível
                        startLevel: -1,
                        capLevelToPlayerSize: true, // Economiza banda e CPU
                        maxBufferLength: 10, // Buffer menor para não estourar memória RAM da TV
                        maxMaxBufferLength: 20
                    };
                    this.hls = new Hls(config);
                    this.hls.loadSource(url);
                    this.hls.attachMedia(this.video);
                    this.hls.on(Hls.Events.MANIFEST_PARSED, function() { PlayerEngine.video.play().catch(e=>{}); });
                    this.hls.on(Hls.Events.ERROR, function(event, data) {
                        if (data.fatal) { 
                            if(data.type === Hls.ErrorTypes.NETWORK_ERROR) PlayerEngine.hls.startLoad(); else PlayerEngine.destroy(); 
                        }
                    });
                } else {
                    this.video.src = url; 
                    this.video.play().catch(e=>{});
                }
            },
            destroy: function() { 
                if(this.hls) { this.hls.destroy(); this.hls = null; } 
                if(this.video) { this.video.pause(); this.video.removeAttribute('src'); this.video.load(); } 
            }
        };

        // --- APLICAÇÃO PRINCIPAL ---
        var App = {
            scr: 0, zone: 0, idx: 0, lastCatIdx: 0, creds: {}, fullData: [], storedList: [], isFolder: false, seriesEps: [], playingId: null,

            init: function() {
                FavManager.init();
                // Auto-fill login
                if(localStorage.getItem('rc_h')) {
                    document.getElementById('i0').value = localStorage.getItem('rc_h');
                    document.getElementById('i1').value = localStorage.getItem('rc_u');
                    document.getElementById('i2').value = localStorage.getItem('rc_p');
                }
                PlayerEngine.init();
                
                // Evento de fim de vídeo (Séries)
                document.getElementById('player').onended = function() { 
                    if(App.mode==='series' && App.isFolder && App.idx < App.seriesEps.length-1) {
                        App.idx++; App.updateFocus(); App.playStream(App.seriesEps[App.idx]);
                    } else App.exitFull(); 
                };
                
                setInterval(function(){
                    var d = new Date();
                    document.getElementById('clock-time').innerText = d.getHours().toString().padStart(2,'0') + ":" + d.getMinutes().toString().padStart(2,'0');
                }, 1000); // Relógio simples

                this.updateFocus();
            },

            // Função para sincronizar o Mouse com o Controle (Air Mouse Magic)
            mouseFocus: function(scr, idx, zone) {
                if(this.scr !== scr) return; // Segurança
                if(zone !== undefined) this.zone = zone;
                if(idx !== -1) this.idx = idx;
                this.updateFocus(true); // true = origem mouse
            },

            req: function(url, cb) {
                var x = new XMLHttpRequest(); x.open("GET", url, true); x.timeout = 15000;
                x.onload = function() { if(x.status===200) { try{cb(JSON.parse(x.responseText));}catch(e){cb(null);} } else cb(null); };
                x.onerror = function(){ cb(null); }; 
                x.send();
            },

            login: function() {
                var h = document.getElementById('i0').value.trim();
                var u = document.getElementById('i1').value.trim();
                var p = document.getElementById('i2').value.trim();
                if(h.indexOf('http') === -1) h = 'http://' + h;
                
                document.getElementById('loader').classList.remove('hide');
                this.req(h+"/player_api.php?username="+u+"&password="+p, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d && d.user_info && d.user_info.auth==1) {
                        App.creds={h:h,u:u,p:p};
                        localStorage.setItem('rc_h', h); localStorage.setItem('rc_u', u); localStorage.setItem('rc_p', p);
                        var exp = d.user_info.exp_date ? new Date(d.user_info.exp_date*1000).toLocaleDateString("pt-BR") : "Ilimitado";
                        document.getElementById('info-exp').innerText = "VENC: " + exp;
                        App.setScr(1);
                    } else document.getElementById('msg-login').innerText="DADOS INVÁLIDOS";
                });
            },
            logout: function() { localStorage.clear(); location.reload(); },

            setScr: function(n) {
                if(n===1) PlayerEngine.destroy();
                document.querySelectorAll('.layer').forEach(function(l){l.classList.add('hide')});
                if(n===0) document.getElementById('login-layer').classList.remove('hide');
                if(n===1) document.getElementById('dash-layer').classList.remove('hide');
                if(n===2) document.getElementById('content-layer').classList.remove('hide');
                this.scr=n; this.zone=0; this.idx=0; this.updateFocus();
            },

            openMode: function(m) {
                this.mode = m; this.setScr(2); this.isFolder = false; 
                document.getElementById('cat-list').innerHTML = ''; document.getElementById('item-list').innerHTML = '';
                document.getElementById('loader').classList.remove('hide');
                document.getElementById('meta-title').innerText = m === 'live' ? "TV AO VIVO" : (m==='movie'?"FILMES":"SÉRIES");
                
                var act = (m==='live')?'get_live_categories':(m==='movie'?'get_vod_categories':'get_series_categories');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        var h = '<div class="cat-item" id="c0" onmouseenter="App.mouseFocus(2,0,0)" onclick="App.catClick(0)">★ FAVORITOS</div>';
                        // Limita categorias para performance se houver muitas
                        for(var i=0;i<d.length;i++) h += '<div class="cat-item" id="c'+(i+1)+'" data-id="'+d[i].category_id+'" onmouseenter="App.mouseFocus(2,'+(i+1)+',0)" onclick="App.catClick('+(i+1)+')">'+d[i].category_name+'</div>';
                        document.getElementById('cat-list').innerHTML = h;
                        App.zone=0; App.idx=0; App.updateFocus();
                    }
                });
            },

            catClick: function(i) { this.idx=i; this.zone=0; this.loadContent(i); },

            loadContent: function(catIdx) {
                this.lastCatIdx = catIdx; 
                var el = document.getElementById('c'+catIdx); if(!el) return;
                var cid = el.getAttribute('data-id');
                
                document.querySelectorAll('.cat-item').forEach(e=>e.classList.remove('active'));
                el.classList.add('active');
                
                document.getElementById('loader').classList.remove('hide');
                document.getElementById('item-list').innerHTML = '';

                var cb = function(d) {
                    document.getElementById('loader').classList.add('hide');
                    if(d) { App.fullData = d; App.isFolder = false; App.renderList(); }
                };

                var url = this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=";
                if(cid) {
                     var act = (this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                     this.req(url+act+"&category_id="+cid, cb);
                } else {
                     // Favoritos
                     var act = (this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                     this.req(url+act, function(d){
                         if(d) { App.fullData = d.filter(x => FavManager.isFav(x.stream_id || x.series_id)); App.isFolder=false; App.renderList(); }
                         document.getElementById('loader').classList.add('hide');
                     });
                }
            },

            renderList: function(keepIdx) {
                var d = this.fullData;
                if(!d || d.length===0) { document.getElementById('item-list').innerHTML = '<div style="padding:20px;">Vazio</div>'; return; }
                
                // Otimização de renderização (Fragmento de Documento)
                var html = '';
                var max = d.length > 500 ? 500 : d.length; // Limite hard para não travar Philco
                
                for(var i=0; i<max; i++) {
                    var n = d[i].name || d[i].title;
                    var id = d[i].stream_id || d[i].series_id;
                    var fav = FavManager.isFav(id) ? '<i class="fas fa-star fav-icon"></i>' : '';
                    // Importante: onmouseenter para Air Mouse
                    html += `<div class="item" id="row-${i}" onmouseenter="App.mouseFocus(2,${i},2)" onclick="App.itemClick(${i})">${n}${fav}</div>`;
                }
                document.getElementById('item-list').innerHTML = html;
                
                this.zone = 2;
                if(!keepIdx) this.idx = 0;
                this.updateFocus();
            },

            itemClick: function(i) { this.idx=i; this.zone=2; this.clickItem(); },
            clickItem: function() {
                if(this.isFolder) { this.playStream(this.seriesEps[this.idx]); return; }
                var item = this.fullData[this.idx];
                if(this.mode !== 'series') { if(item) this.playStream(item); return; }
                
                // Lógica de Séries
                if(item) {
                    this.storedList = [...this.fullData]; this.memIdx = this.idx;
                    document.getElementById('loader').classList.remove('hide');
                    this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=get_series_info&series_id="+item.series_id, function(d){
                        document.getElementById('loader').classList.add('hide');
                        if(d && d.episodes) {
                            var eps = [];
                            for(var k in d.episodes) for(var j=0; j<d.episodes[k].length; j++) eps.push(d.episodes[k][j]);
                            App.seriesEps = eps; App.fullData = eps; App.isFolder = true; App.renderList();
                        }
                    });
                }
            },

            playStream: function(item) {
                var ext = (this.mode==='live')?'ts':(item.container_extension||'mp4');
                var type = (this.mode==='live')?'live':(this.mode==='movie'?'movie':'series');
                var id = item.stream_id || item.id;
                var url = this.creds.h+"/"+type+"/"+this.creds.u+"/"+this.creds.p+"/"+id+"."+ext;
                
                this.playingId = id;
                document.getElementById('meta-title').innerText = item.name || item.title;
                document.getElementById('meta-desc').innerText = "Carregando sinal...";
                document.getElementById('meta-epg').classList.add('hide');
                
                if(this.mode === 'live') {
                    // EPG Simplificado
                    this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=get_short_epg&stream_id="+id, function(d){
                        if(d && d.epg_listings && d.epg_listings.length > 0) {
                            var t = d.epg_listings[0].title;
                            try { if(window.atob && /^[A-Za-z0-9+/=]+$/.test(t)) t=atob(t); }catch(e){}
                            document.getElementById('meta-epg').innerText = "AGORA: " + t;
                            document.getElementById('meta-epg').classList.remove('hide');
                        }
                    });
                }
                
                PlayerEngine.play(url, this.mode==='live');
                
                // Atualiza visual
                document.querySelectorAll('.item').forEach(e=>e.classList.remove('playing'));
                var r = document.getElementById('row-'+this.idx); if(r) r.classList.add('playing');
            },

            toggleFull: function() {
                var b = document.getElementById('vid-box');
                if(b.classList.contains('fs')) this.exitFull(); else { b.classList.add('fs'); this.osd("TELA CHEIA"); }
            },
            exitFull: function() { document.getElementById('vid-box').classList.remove('fs'); },
            
            osd: function(t) { var o=document.getElementById('osd'); o.innerText=t; o.style.display='block'; setTimeout(function(){o.style.display='none'},2000); },
            
            back: function() {
                if(document.getElementById('vid-box').classList.contains('fs')) { this.exitFull(); return; }
                if(this.zone===2 && this.isFolder) {
                    this.isFolder = false; this.fullData = this.storedList; this.renderList(true); 
                    this.idx = this.memIdx; this.updateFocus(); return; 
                }
                if(this.zone > 0) { this.zone=0; this.idx=this.lastCatIdx; this.updateFocus(); return; }
                if(this.zone===0) { this.setScr(1); return; }
            },
            
            updateFocus: function(fromMouse) {
                document.querySelectorAll('.focused').forEach(function(e){e.classList.remove('focused')});
                var el;
                if(this.scr===0) el=document.getElementById('i'+this.idx);
                if(this.scr===1) el=document.getElementById('m'+this.idx);
                if(this.scr===2) {
                    if(this.zone===0) el=document.getElementById('c'+this.idx);
                    if(this.zone===1) el=document.getElementById('search');
                    if(this.zone===2) el=document.getElementById('row-'+this.idx);
                    if(this.zone===3) el=document.getElementById('vid-box');
                }
                if(el) {
                    el.classList.add('focused'); 
                    if(!fromMouse) { // Só rola scroll se for via teclado, senão o mouse briga com a tela
                        el.scrollIntoView({block:'center',behavior:'auto'}); // behavior:auto é mais rápido que smooth
                    }
                }
            },
            
            // Navegação Teclado
            move: function(d) {
                // Lógica simplificada para D-PAD
                if(this.scr===0) { if(d===1&&this.idx<3) this.idx++; if(d===0&&this.idx>0) this.idx--; }
                if(this.scr===1) { if(d===3&&this.idx<3) this.idx++; if(d===2&&this.idx>0) this.idx--; }
                if(this.scr===2) {
                    if(this.zone===0) { 
                        if(d===1 && this.idx < document.getElementById('cat-list').children.length-1) this.idx++;
                        if(d===0 && this.idx > 0) this.idx--;
                        if(d===3) { this.zone=2; this.idx=0; }
                    }
                    else if(this.zone===2) {
                        if(d===1 && this.idx < document.getElementById('item-list').children.length-1) this.idx++;
                        if(d===0 && this.idx > 0) this.idx--;
                        if(d===2) { this.zone=0; this.idx=this.lastCatIdx; }
                        if(d===3) { this.zone=3; }
                    }
                    else if(this.zone===3) { if(d===2) { this.zone=2; this.idx=0; } }
                }
                this.updateFocus();
            },
            
            // Busca estilo mouse (Input)
            doSearch: function() {
                var t = document.getElementById('search').value.toLowerCase();
                if(t.length < 2) return;
                var act = (App.mode==='live')?'get_live_streams':(App.mode==='movie'?'get_vod_streams':'get_series');
                App.req(App.creds.h+"/player_api.php?username="+App.creds.u+"&password="+App.creds.p+"&action="+act, function(d){ 
                    if(d) {
                        App.fullData = d.filter(x=>(x.name||x.title||"").toLowerCase().includes(t)); 
                        App.renderList(); 
                    }
                });
            }
        };

        // CONTROLE REMOTO (TECLADO FÍSICO)
        document.addEventListener('keydown', function(e) {
            var k=e.keyCode;
            if(document.activeElement.tagName === 'INPUT') {
                if(k===13) { if(App.scr===2) App.doSearch(); else App.login(); }
                if(k===40 && App.scr===2) { App.zone=2; App.idx=0; App.updateFocus(); document.getElementById('search').blur(); }
                return;
            }
            if(k===37) { e.preventDefault(); App.move(2); } 
            if(k===38) { e.preventDefault(); App.move(0); }
            if(k===39) { e.preventDefault(); App.move(3); } 
            if(k===40) { e.preventDefault(); App.move(1); }
            if(k===13) { e.preventDefault(); if(App.scr===2 && App.zone===2) App.clickItem(); else if(App.scr===2 && App.zone===0) App.loadContent(App.idx); else if(App.scr===1) App.openMode(['live','movie','series'][App.idx]); }
            if(k===8||k===27||k===461) { e.preventDefault(); App.back(); }
            if(k===403||k===82) if(App.scr===2) App.toggleFull(); 
        });
    </script>
</body>
</html>
