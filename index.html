<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV GOLD | V12 DEFINITIVE</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        /* --- TEMA PREMIUM DARK/GOLD V12 --- */
        :root {
            --bg: #000000;
            --gold: #FFD700;
            --gold-dim: #b8860b;
            --panel: #0a0a0a;
            --sel-bg: #1a1a1a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }

        body {
            background-color: var(--bg);
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            width: 100vw; height: 100vh; overflow: hidden;
            background: #000; /* Performance máxima */
        }

        .hide { display: none !important; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: #000; }
        .flex-center { display: flex; align-items: center; justify-content: center; }

        /* --- FOCO --- */
        .focused {
            border: 2px solid #fff !important;
            transform: scale(1.01);
            z-index: 100;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
        }
        
        /* CARD MENU FOCADO */
        .home-card.focused {
            background: linear-gradient(180deg, #FFD700 0%, #FFA500 100%) !important;
            border: none !important;
        }
        .home-card.focused i, .home-card.focused span { color: #000 !important; font-weight: 900; }

        /* LISTA FOCADA (Barra Lateral Dourada) */
        .list-item.focused, .cat-item.focused {
            background: #222 !important;
            border-left: 5px solid var(--gold) !important;
            border-bottom: 1px solid #333 !important;
            color: #fff !important;
            transform: none !important;
        }

        /* PLAYER FOCADO */
        #vid-container.focused {
            background: #000 !important;
            border: 3px solid var(--gold) !important;
            transform: none !important;
        }

        /* --- LOGIN --- */
        .login-box { width: 400px; padding: 40px; background: #111; border: 1px solid #333; border-radius: 10px; text-align: center; }
        .logo-txt { font-size: 32px; font-weight: 800; margin-bottom: 20px; }
        .logo-txt span { color: var(--gold); }
        .inp { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: #fff; text-align: center; font-weight: bold; }
        .btn { width: 100%; padding: 12px; margin-top: 15px; background: var(--gold); color: #000; font-weight: 800; border: none; cursor: pointer; }
        .cors-opt { font-size: 11px; color: #666; margin-top: 10px; }

        /* --- DASHBOARD V10 (CARDS) --- */
        #dash-layer { display: flex; flex-direction: column; justify-content: space-between; padding: 40px; background: radial-gradient(circle, #1a1a1a 0%, #000000 100%); }
        
        .top-header { display: flex; justify-content: space-between; align-items: center; }
        .welcome { font-size: 20px; color: #ccc; }
        .welcome b { color: var(--gold); margin-left: 5px; font-size: 24px; }
        .clock-box { text-align: center; }
        .time-big { font-size: 40px; font-weight: 300; line-height: 1; }
        .date-small { font-size: 12px; color: var(--gold); letter-spacing: 2px; }
        .power-btn { font-size: 24px; color: #666; padding: 10px; border-radius: 50%; }

        .cards-area { display: flex; gap: 30px; justify-content: center; align-items: center; height: 50vh; }
        .home-card { 
            width: 240px; height: 320px; background: #0f0f0f; 
            border: 1px solid #222; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .home-card i { font-size: 60px; margin-bottom: 30px; color: #ccc; }
        .home-card span { font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

        .bottom-info { 
            display: flex; justify-content: center; gap: 50px; 
            padding: 15px; background: rgba(255,255,255,0.05); border-radius: 50px; 
            width: fit-content; margin: 0 auto; border: 1px solid #222;
        }
        .b-lbl { font-size: 10px; color: #666; font-weight: 800; display: block; margin-bottom: 2px; text-align: center; }
        .b-val { font-size: 14px; color: var(--gold); font-weight: 700; text-align: center; }

        /* --- 3 COLUNAS (FIXO) --- */
        #content-layer { display: flex; height: 100vh; background: #000; overflow: hidden; }

        /* Col 1: Categorias */
        .col-cat { width: 22%; background: #080808; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .head { padding: 15px; background: #000; color: var(--gold); text-align: center; font-weight: 800; border-bottom: 2px solid var(--gold); }
        .cat-list { flex: 1; overflow-y: auto; }
        .cat-item { padding: 14px 20px; border-bottom: 1px solid #151515; font-size: 13px; color: #888; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .cat-item.active { background: #151515; border-left: 4px solid var(--gold); color: #fff; }

        /* Col 2: Lista (Canais/Filmes/Episódios) */
        .col-list { width: 30%; background: #111; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .search-area { padding: 10px; background: #050505; border-bottom: 1px solid #222; }
        .inp-search { width: 100%; background: #222; border: 1px solid #333; color: #fff; padding: 8px; text-align: center; border-radius: 4px; }
        .item-list { flex: 1; overflow-y: auto; }
        .list-item { padding: 14px 20px; border-bottom: 1px solid #1a1a1a; font-size: 14px; color: #bbb; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .list-item.playing { color: var(--gold); font-weight: 800; background: rgba(255, 215, 0, 0.1); border-left: 3px solid var(--gold); }
        
        /* Breadcrumb para Séries (Voltar) */
        .bread-back { padding: 10px; background: #222; color: var(--gold); font-weight: 800; text-align: center; cursor: pointer; border-bottom: 1px solid var(--gold); }

        /* Col 3: Player & Info */
        .col-play { flex: 1; background: #000; display: flex; flex-direction: column; position: relative; }
        
        #vid-container { width: 100%; aspect-ratio: 16/9; background: #000; position: relative; border-bottom: 2px solid #222; }
        #vid-container.fs { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999; border: none !important; }
        
        video { width: 100%; height: 100%; object-fit: contain; }

        .meta { flex: 1; padding: 25px; background: #080808; display: flex; flex-direction: column; overflow: hidden; }
        .meta-title { font-size: 22px; color: var(--gold); font-weight: 700; margin-bottom: 10px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .meta-desc { font-size: 13px; color: #777; overflow-y: auto; flex: 1; line-height: 1.5; }
        .keys { display: flex; gap: 15px; margin-top: 15px; border-top: 1px solid #222; padding-top: 15px; }
        .key { font-size: 10px; color: #666; font-weight: 700; display: flex; align-items: center; gap: 5px; text-transform: uppercase; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        #loader { background: #000; z-index: 20000; flex-direction: column; color: var(--gold); font-weight: 800; }
        .osd { position: absolute; top: 20px; right: 20px; background: rgba(255,215,0,0.9); color: #000; padding: 5px 15px; font-weight: 800; border-radius: 4px; display: none; z-index: 10001; }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #333; }
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="layer hide flex-center">
        <i class="fas fa-circle-notch fa-spin" style="font-size:40px; margin-bottom:20px"></i>
        <div>CARREGANDO...</div>
    </div>

    <div id="login-layer" class="layer flex-center">
        <div class="login-box">
            <div class="logo-txt">IPTV <span>GOLD</span></div>
            <input type="text" id="i0" class="inp focusable" placeholder="URL DNS" autocomplete="off">
            <input type="text" id="i1" class="inp focusable" placeholder="USUÁRIO" autocomplete="off">
            <input type="password" id="i2" class="inp focusable" placeholder="SENHA" autocomplete="off">
            <div class="cors-opt"><input type="checkbox" id="chk-proxy" class="focusable"> <label>Modo Proxy (Correção)</label></div>
            <button id="i3" class="btn focusable" onclick="App.login()">ENTRAR</button>
            <div id="msg-login" style="color:red; margin-top:10px; font-size:12px; font-weight:bold"></div>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="top-header">
            <div class="welcome">OLÁ, <b id="user-name">VIP</b></div>
            <div class="clock-box">
                <div class="time-big" id="clock-time">00:00</div>
                <div class="date-small" id="clock-date">DATA</div>
            </div>
            <div id="m3" class="power-btn focusable" onclick="App.logout()"><i class="fas fa-power-off"></i></div>
        </div>
        <div class="cards-area">
            <div id="m0" class="home-card focusable" onclick="App.openMode('live')"><i class="fas fa-tv"></i><span>TV Ao Vivo</span></div>
            <div id="m1" class="home-card focusable" onclick="App.openMode('movie')"><i class="fas fa-film"></i><span>Filmes</span></div>
            <div id="m2" class="home-card focusable" onclick="App.openMode('series')"><i class="fas fa-layer-group"></i><span>Séries</span></div>
        </div>
        <div class="bottom-info">
            <div><span class="b-lbl">CRIADO</span><span id="info-created" class="b-val">--</span></div>
            <div><span class="b-lbl">VENCIMENTO</span><span id="info-exp" class="b-val" style="color:#f44">--</span></div>
            <div><span class="b-lbl">CONEXÕES</span><span id="info-conn" class="b-val">--</span></div>
        </div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="col-cat">
            <div class="head">CATEGORIAS</div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="col-list">
            <div class="search-area"><input type="text" id="search" class="inp-search focusable" placeholder="BUSCAR..."></div>
            <div id="btn-back-series" class="bread-back hide focusable" onclick="App.exitSeries()">❮ VOLTAR PARA SÉRIES</div>
            <div id="item-list" class="item-list"></div>
        </div>
        <div class="col-play">
            <div id="vid-container" class="focusable">
                <video id="player" playsinline webkit-playsinline></video>
                <div id="osd" class="osd"></div>
            </div>
            <div class="meta">
                <div id="meta-title" class="meta-title">AGUARDANDO...</div>
                <div id="meta-desc" class="meta-desc">Selecione um canal ou episódio.</div>
                <div class="keys">
                    <div class="key"><div class="dot" style="background:red"></div> TELA CHEIA</div>
                    <div class="key"><div class="dot" style="background:green"></div> PRÓXIMO</div>
                    <div class="key"><div class="dot" style="background:blue"></div> MENU</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var Player = {
            hls: null, video: null, url: null, retry: 0,
            init: function() {
                this.video = document.getElementById('player');
                this.video.onerror = function() { Player.handleError(); };
                this.video.onended = function() { if(App.mode!=='live') App.playNext(); };
            },
            play: function(url, isLive) {
                if(this.url===url && !this.video.paused) return;
                this.stop(); this.url=url; this.retry=0; this.video.controls=true;
                App.osd("CARREGANDO...");
                
                var isVOD = url.match(/\.(mp4|mkv|avi)$/i) || !isLive;
                if(isVOD) {
                    this.video.src = url;
                    this.video.play().catch(e=>console.log(e));
                } else {
                    if(url.indexOf('.m3u8')===-1 && url.indexOf('.ts')>-1) url=url.replace('.ts','.m3u8');
                    if(Hls.isSupported()) {
                        var config = { enableWorker: true, maxBufferLength: 10 };
                        this.hls = new Hls(config);
                        this.hls.loadSource(url);
                        this.hls.attachMedia(this.video);
                        this.hls.on(Hls.Events.MANIFEST_PARSED, function(){ Player.video.play(); });
                    } else { this.video.src=url; this.video.play(); }
                }
            },
            handleError: function() {
                this.retry++;
                if(this.retry>2) { this.stop(); App.osd("SINAL OFFLINE."); return; }
                App.osd("RECONECTANDO "+this.retry+"...");
                setTimeout(()=>{ if(Player.hls) Player.hls.recoverMediaError(); else Player.video.load(); }, 1500);
            },
            stop: function() {
                if(this.hls) { this.hls.destroy(); this.hls=null; }
                this.video.pause(); this.video.removeAttribute('src'); this.video.load();
            }
        };

        var App = {
            scr: 0, zone: 0, idx: 0, creds: {}, data: [], filtered: [], seriesCache: [], insideSeries: false, playingIdx: -1,
            
            init: function() {
                if(localStorage.getItem('gh')) {
                    document.getElementById('i0').value = localStorage.getItem('gh');
                    document.getElementById('i1').value = localStorage.getItem('gu');
                    document.getElementById('i2').value = localStorage.getItem('gp');
                }
                Player.init(); this.clock(); this.updateFocus();
            },
            clock: function() { setInterval(()=>{ var d=new Date(); document.getElementById('clock-time').innerText=d.getHours()+":"+(d.getMinutes()<10?'0':'')+d.getMinutes(); document.getElementById('clock-date').innerText=d.toLocaleDateString('pt-BR'); },1000); },
            req: function(url, cb) {
                var p=document.getElementById('chk-proxy').checked;
                var u=p ? 'https://api.allorigins.win/raw?url='+encodeURIComponent(url) : url;
                var x=new XMLHttpRequest(); x.open("GET",u,true); x.timeout=15000;
                x.onload=function(){ try{cb(JSON.parse(x.responseText));}catch(e){cb(null);} }; x.onerror=function(){cb(null);}; x.send();
            },
            login: function() {
                var h=document.getElementById('i0').value.trim();
                var u=document.getElementById('i1').value.trim();
                var p=document.getElementById('i2').value.trim();
                if(!h||!u||!p) return;
                if(h.endsWith('/')) h=h.slice(0,-1); if(h.indexOf('http')===-1) h='http://'+h;
                document.getElementById('loader').classList.remove('hide');
                this.req(h+"/player_api.php?username="+u+"&password="+p, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d && d.user_info && d.user_info.auth==1) {
                        App.creds={h:h,u:u,p:p}; localStorage.setItem('gh',h); localStorage.setItem('gu',u); localStorage.setItem('gp',p);
                        document.getElementById('user-name').innerText = d.user_info.username;
                        document.getElementById('info-exp').innerText = d.user_info.exp_date ? new Date(d.user_info.exp_date*1000).toLocaleDateString() : "Ilimitado";
                        document.getElementById('info-conn').innerText = d.user_info.active_cons+"/"+d.user_info.max_connections;
                        App.setScr(1);
                    } else document.getElementById('msg-login').innerText="Erro Login. Tente Proxy.";
                });
            },
            logout: function() { localStorage.clear(); location.reload(); },
            setScr: function(n) {
                if(n===1) { Player.stop(); App.data=[]; }
                document.querySelectorAll('.layer').forEach(e=>e.classList.add('hide'));
                if(n===0) document.getElementById('login-layer').classList.remove('hide');
                if(n===1) document.getElementById('dash-layer').classList.remove('hide');
                if(n===2) document.getElementById('content-layer').classList.remove('hide');
                this.scr=n; this.zone=0; this.idx=0; this.updateFocus();
            },
            openMode: function(m) {
                this.mode=m; this.setScr(2);
                document.getElementById('cat-list').innerHTML=''; document.getElementById('item-list').innerHTML='';
                document.getElementById('loader').classList.remove('hide');
                var act = (m==='live')?'get_live_categories':(m==='movie'?'get_vod_categories':'get_series_categories');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        var h=''; for(var i=0; i<d.length; i++) h+=`<div class="cat-item" id="c${i}" onclick="App.loadCat(${i},'${d[i].category_id}')">${d[i].category_name}</div>`;
                        document.getElementById('cat-list').innerHTML=h;
                        App.zone=0; App.idx=0; App.updateFocus();
                    }
                });
            },
            loadCat: function(idx, cid) {
                document.querySelectorAll('.cat-item').forEach(e=>e.classList.remove('active'));
                document.getElementById('c'+idx).classList.add('active');
                document.getElementById('loader').classList.remove('hide');
                this.insideSeries = false; document.getElementById('btn-back-series').classList.add('hide');
                var act = (this.mode==='live')?'get_live_streams':(this.mode==='movie'?'get_vod_streams':'get_series');
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action="+act+"&category_id="+cid, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) { App.data=d; App.filtered=d; App.renderList(); App.zone=1; App.idx=0; App.updateFocus(); }
                });
            },
            renderList: function() {
                var h=''; var max=this.filtered.length>200?200:this.filtered.length;
                if(max===0) h='<div style="padding:15px">Vazio</div>';
                for(var i=0; i<max; i++) {
                    var n = this.filtered[i].name || this.filtered[i].title;
                    h+=`<div class="list-item" id="r${i}" onclick="App.clickItem(${i})">${n}</div>`;
                }
                document.getElementById('item-list').innerHTML=h;
            },
            clickItem: function(i) {
                var item = this.filtered[i];
                // LÓGICA DE SÉRIES (Drill-Down)
                if(this.mode === 'series' && !this.insideSeries) {
                    this.loadEpisodes(item);
                    return;
                }
                // PLAY
                var id = item.stream_id || item.id; // Series ep has 'id'
                var ext = item.container_extension || 'mp4';
                var type = (this.mode==='live')?'live':(this.mode==='movie'?'movie':'series');
                var url = `${this.creds.h}/${type}/${this.creds.u}/${this.creds.p}/${id}.${ext}`;
                document.getElementById('meta-title').innerText = item.name || item.title;
                document.getElementById('meta-desc').innerText = "Reproduzindo...";
                document.querySelectorAll('.list-item').forEach(e=>e.classList.remove('playing'));
                document.getElementById('r'+i).classList.add('playing');
                this.playingIdx = i; this.zone=2; this.updateFocus();
                Player.play(url, this.mode==='live');
            },
            loadEpisodes: function(item) {
                document.getElementById('loader').classList.remove('hide');
                this.seriesCache = this.filtered; // Salva lista de séries
                this.req(this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=get_series_info&series_id="+item.series_id, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d && d.episodes) {
                        var eps=[];
                        for(var k in d.episodes) { for(var j=0; j<d.episodes[k].length; j++) eps.push(d.episodes[k][j]); }
                        App.filtered = eps;
                        App.insideSeries = true;
                        document.getElementById('btn-back-series').classList.remove('hide');
                        App.renderList();
                        App.zone=1; App.idx=0; App.updateFocus();
                    }
                });
            },
            exitSeries: function() {
                this.filtered = this.seriesCache;
                this.insideSeries = false;
                document.getElementById('btn-back-series').classList.add('hide');
                this.renderList();
                this.zone=1; this.idx=0; this.updateFocus();
            },
            playNext: function() {
                if(this.playingIdx < this.filtered.length-1) {
                    App.osd("PRÓXIMO VÍDEO >>"); setTimeout(()=>App.clickItem(App.playingIdx+1), 2000);
                }
            },
            toggleFull: function() {
                var el=document.getElementById('vid-container');
                if(el.classList.contains('fs')) el.classList.remove('fs'); else { el.classList.add('fs'); App.osd("TELA CHEIA"); }
            },
            osd: function(t) { var o=document.getElementById('osd'); o.innerText=t; o.style.display='block'; setTimeout(()=>o.style.display='none',3000); },
            updateFocus: function() {
                document.querySelectorAll('.focused').forEach(e=>e.classList.remove('focused'));
                var el;
                if(this.scr===0) el=document.getElementById('i'+this.idx)||document.getElementById('chk-proxy');
                else if(this.scr===1) el=document.getElementById('m'+this.idx);
                else if(this.scr===2) {
                    if(this.zone===0) el=document.getElementById('c'+this.idx);
                    else if(this.zone===1) el=document.getElementById('r'+this.idx)||document.getElementById('search')||document.getElementById('btn-back-series');
                    else if(this.zone===2) el=document.getElementById('vid-container');
                }
                if(el) { el.classList.add('focused'); el.scrollIntoView({block:'center'}); if(el.tagName==='INPUT') el.focus(); else document.activeElement.blur(); }
            },
            move: function(d) {
                if(this.scr===0) { if(d===1 && this.idx<4) this.idx++; if(d===0 && this.idx>0) this.idx--; }
                else if(this.scr===1) {
                    if(this.idx<=2) { if(d===3) this.idx++; if(d===2) this.idx--; if(d===0) this.idx=3; } else if(d===1) this.idx=1;
                }
                else if(this.scr===2) {
                    if(this.zone===0) { if(d===1) this.idx++; if(d===0 && this.idx>0) this.idx--; if(d===3) { this.zone=1; this.idx=0; } }
                    else if(this.zone===1) { 
                        var limit = this.filtered.length-1;
                        if(d===1 && this.idx<limit) this.idx++; 
                        if(d===0) { if(this.idx>0) this.idx--; else if(this.insideSeries) document.getElementById('btn-back-series').focus(); }
                        if(d===2) { this.zone=0; this.idx=0; } 
                        if(d===3) this.zone=2;
                    }
                    else if(this.zone===2) { if(d===2) this.zone=1; }
                }
                this.updateFocus();
            },
            enter: function() {
                if(this.scr===0) this.login();
                else if(this.scr===1) { if(this.idx===3) this.logout(); else this.openMode(['live','movie','series'][this.idx]); }
                else if(this.scr===2) {
                    if(this.zone===0) { var cid=document.getElementById('c'+this.idx).getAttribute('onclick'); eval(cid); } // Trick to get ID
                    else if(this.zone===1) { 
                        if(document.activeElement.id==='btn-back-series') this.exitSeries();
                        else this.clickItem(this.idx); 
                    }
                    else if(this.zone===2) this.toggleFull();
                }
            },
            back: function() {
                if(document.getElementById('vid-container').classList.contains('fs')) { this.toggleFull(); return; }
                if(this.zone===2) { this.zone=1; this.updateFocus(); return; }
                if(this.zone===1) { 
                    if(this.insideSeries) this.exitSeries(); 
                    else { this.zone=0; this.updateFocus(); } 
                    return; 
                }
                if(this.zone===0) { this.setScr(1); return; }
                if(this.scr===1) this.setScr(0);
            }
        };

        document.addEventListener('keydown', function(e) {
            var k=e.keyCode;
            if(document.activeElement.tagName==='INPUT' && k!==13 && k!==40) return;
            e.preventDefault();
            if(k===37) App.move(2); if(k===38) App.move(0); if(k===39) App.move(3); if(k===40) App.move(1);
            if(k===13) App.enter();
            if(k===8||k===27||k===461) App.back();
            if(k===403||k===82) App.toggleFull();
        });
    </script>
</body>
</html>
