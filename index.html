<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKY GOLD STABLE</title>
    <style>
        /* --- RESET E VARIÁVEIS --- */
        :root {
            --gold: #FFD700;
            --bg-dark: #090909;
            --bg-panel: #111;
            --text-gray: #888;
            --focus-bg: #FFD700;
            --focus-text: #000;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        body { background: #000; color: #fff; font-family: sans-serif; height: 100vh; overflow: hidden; }

        /* --- TELA DE LOGIN --- */
        #login-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            width: 350px; padding: 40px; background: #111; border: 1px solid #333;
            text-align: center; border-top: 3px solid var(--gold);
        }
        .inp {
            width: 100%; padding: 10px; margin-bottom: 10px;
            background: #222; border: 1px solid #333; color: white; text-align: center;
        }
        .btn {
            width: 100%; padding: 12px; background: #333; color: #fff; border: none; font-weight: bold;
        }
        
        /* Foco no Login */
        .inp:focus, .btn:focus {
            background: var(--gold); color: #000; border-color: #fff;
        }

        /* --- INTERFACE PRINCIPAL (3 COLUNAS) --- */
        #app-screen { display: none; width: 100%; height: 100%; flex-direction: column; }

        /* Topo */
        .header {
            height: 60px; background: #1a1a1a; border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }
        .logo { font-weight: bold; font-size: 20px; }
        .logo span { color: var(--gold); }

        /* Corpo */
        .main-body { flex: 1; display: flex; overflow: hidden; }

        /* Coluna 1: Categorias */
        .col-cats {
            width: 260px; background: #0a0a0a; border-right: 1px solid #222;
            display: flex; flex-direction: column;
        }
        .list-title { padding: 10px; background: #000; color: var(--gold); font-size: 12px; font-weight: bold; text-align: center; }
        .cat-scroll { flex: 1; overflow-y: auto; }
        
        .item-cat {
            padding: 12px 15px; color: #999; font-size: 14px; border-left: 4px solid transparent;
        }
        /* Item Ativo (Selecionado Anteriormente) */
        .item-cat.active { background: #151515; color: #fff; border-left-color: #444; }
        /* Item FOCADO (Onde está o cursor agora) */
        .item-cat.focused {
            background: var(--gold); color: #000; border-left-color: #fff; font-weight: bold;
        }

        /* Coluna 2: Lista de Canais */
        .col-chans {
            width: 320px; background: #111; border-right: 1px solid #222;
            display: flex; flex-direction: column;
        }
        .chan-scroll { flex: 1; overflow-y: auto; }
        
        .item-chan {
            padding: 10px 15px; border-bottom: 1px solid #1a1a1a; color: #ccc; font-size: 13px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .item-chan.focused {
            background: var(--gold); color: #000; font-weight: bold;
            box-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        .item-chan.playing { color: var(--gold); }

        /* Coluna 3: Player e EPG */
        .col-player {
            flex: 1; background: #000; display: flex; flex-direction: column; padding: 20px;
        }
        .video-box {
            width: 100%; aspect-ratio: 16/9; background: #000; border: 1px solid #333;
            margin-bottom: 20px; position: relative;
        }
        .video-box.highlight { border-color: var(--gold); }
        video { width: 100%; height: 100%; }
        
        .epg-mock { color: #555; font-size: 14px; margin-top: 10px; }
        .epg-title { color: #fff; font-size: 18px; margin-bottom: 5px; }

        /* Tela Cheia */
        .fullscreen { position: fixed; top: 0; left: 0; width: 100vw !important; height: 100vh !important; z-index: 9999; border: none; }

    </style>
</head>
<body onload="init()">

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#fff; margin-bottom:20px">SKY <span style="color:var(--gold)">GOLD</span></h2>
            <input type="text" id="ipt-host" class="inp" placeholder="http://url">
            <input type="text" id="ipt-user" class="inp" placeholder="Usuário">
            <input type="password" id="ipt-pass" class="inp" placeholder="Senha">
            <button id="btn-login" class="btn" onclick="doLogin()">ENTRAR</button>
        </div>
    </div>

    <div id="app-screen">
        <div class="header">
            <div class="logo">SKY <span>GOLD</span></div>
            <div style="color:white; font-weight:bold;" id="clock">00:00</div>
        </div>

        <div class="main-body">
            <div class="col-cats">
                <div class="list-title">CATEGORIAS</div>
                <div class="cat-scroll" id="list-cats"></div>
            </div>

            <div class="col-chans">
                <div class="list-title">CANAIS</div>
                <div class="chan-scroll" id="list-chans">
                    <div style="padding:20px; text-align:center; color:#444">Selecione ao lado</div>
                </div>
            </div>

            <div class="col-player">
                <div class="video-box" id="v-box">
                    <video id="player"></video>
                </div>
                <div class="epg-mock">
                    <div class="epg-title" id="lbl-now">Aguardando seleção...</div>
                    <div id="lbl-next">Use as setas para navegar</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ESTADO GLOBAL ---
        let STATE = {
            screen: 'login', // login, app
            zone: 0,         // 0: categorias, 1: canais
            catIdx: 0,
            chanIdx: 0,
            cats: [],
            chans: [],
            creds: {}
        };

        // --- INICIALIZAÇÃO ---
        function init() {
            if(localStorage.getItem('h')) {
                document.getElementById('ipt-host').value = localStorage.getItem('h');
                document.getElementById('ipt-user').value = localStorage.getItem('u');
                document.getElementById('ipt-pass').value = localStorage.getItem('p');
            }
            document.getElementById('ipt-host').focus();
            setInterval(() => {
                let d = new Date();
                document.getElementById('clock').innerText = d.getHours()+":"+d.getMinutes().toString().padStart(2,'0');
            }, 1000);
        }

        // --- LOGIN ---
        async function doLogin() {
            let h = document.getElementById('ipt-host').value;
            let u = document.getElementById('ipt-user').value;
            let p = document.getElementById('ipt-pass').value;
            
            if(!h.startsWith('http')) h = 'http://'+h;

            let btn = document.getElementById('btn-login');
            btn.innerText = "CARREGANDO...";

            try {
                // Pega categorias
                let res = await fetch(`${h}/player_api.php?username=${u}&password=${p}&action=get_live_categories`);
                let json = await res.json();

                if(Array.isArray(json)) {
                    // SUCESSO
                    localStorage.setItem('h',h); localStorage.setItem('u',u); localStorage.setItem('p',p);
                    STATE.creds = {h,u,p};
                    STATE.cats = json;
                    
                    // Renderiza Categorias
                    let html = '';
                    STATE.cats.forEach((c, i) => {
                        html += `<div class="item-cat" id="cat-${i}">${c.category_name}</div>`;
                    });
                    document.getElementById('list-cats').innerHTML = html;

                    // Troca tela
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('app-screen').style.display = 'flex';
                    STATE.screen = 'app';
                    
                    // Foca na primeira categoria
                    updateFocus();
                } else {
                    alert("Erro no Login");
                    btn.innerText = "ENTRAR";
                }
            } catch(e) {
                alert("Erro Conexão");
                btn.innerText = "ENTRAR";
            }
        }

        // --- CARREGAR CANAIS ---
        async function loadChans() {
            let catId = STATE.cats[STATE.catIdx].category_id;
            let div = document.getElementById('list-chans');
            div.innerHTML = '<div style="padding:10px">Carregando...</div>';

            try {
                let url = `${STATE.creds.h}/player_api.php?username=${STATE.creds.u}&password=${STATE.creds.p}&action=get_live_streams&category_id=${catId}`;
                let res = await fetch(url);
                STATE.chans = await res.json();

                let html = '';
                STATE.chans.forEach((c, i) => {
                    html += `<div class="item-chan" id="chan-${i}">${c.name}</div>`;
                });
                div.innerHTML = html;
            } catch(e) {
                div.innerHTML = 'Erro';
            }
        }

        // --- NAVEGAÇÃO E FOCO (O CORAÇÃO DO SISTEMA) ---
        function updateFocus() {
            // Limpa focos anteriores
            document.querySelectorAll('.focused').forEach(el => el.classList.remove('focused'));

            if(STATE.zone === 0) {
                // Foco na Categoria
                let el = document.getElementById(`cat-${STATE.catIdx}`);
                if(el) {
                    el.classList.add('focused');
                    el.scrollIntoView({block: 'center'});
                }
            } 
            else if(STATE.zone === 1) {
                // Foco no Canal
                let el = document.getElementById(`chan-${STATE.chanIdx}`);
                if(el) {
                    el.classList.add('focused');
                    el.scrollIntoView({block: 'center'});
                }
            }
        }

        // --- CONTROLE REMOTO ---
        document.addEventListener('keydown', (e) => {
            let k = e.keyCode;

            // LOGIN MODE
            if(STATE.screen === 'login') {
                if(k === 13) { document.activeElement.click(); }
                return; // Deixa o navegador controlar TAB/Setas nos inputs nativos
            }

            // APP MODE
            if(STATE.screen === 'app') {
                // Evita scroll da pagina
                if([37,38,39,40].includes(k)) e.preventDefault();

                // VOLTAR / SAIR TELA CHEIA
                if(k === 8 || k === 461 || k === 27) {
                    if(document.fullscreenElement) {
                        document.exitFullscreen();
                    } else if(STATE.zone === 1) {
                        STATE.zone = 0; // Volta pra categoria
                        updateFocus();
                    }
                    return;
                }

                // NAVEGAÇÃO
                if(STATE.zone === 0) { // NAS CATEGORIAS
                    if(k === 38 && STATE.catIdx > 0) STATE.catIdx--;
                    if(k === 40 && STATE.catIdx < STATE.cats.length - 1) STATE.catIdx++;
                    
                    if(k === 39 || k === 13) { // Direita ou Enter -> Abre Categoria
                        // Marca visualmente a categoria pai
                        document.querySelectorAll('.item-cat').forEach(x => x.classList.remove('active'));
                        document.getElementById(`cat-${STATE.catIdx}`).classList.add('active');
                        
                        // Carrega canais e vai para zona 1
                        loadChans().then(() => {
                            STATE.zone = 1;
                            STATE.chanIdx = 0;
                            updateFocus();
                        });
                    }
                    updateFocus();
                }
                
                else if(STATE.zone === 1) { // NOS CANAIS
                    if(k === 38 && STATE.chanIdx > 0) STATE.chanIdx--;
                    if(k === 40 && STATE.chanIdx < STATE.chans.length - 1) STATE.chanIdx++;
                    
                    if(k === 37) { // Esquerda -> Volta para Categorias
                        STATE.zone = 0;
                        updateFocus();
                    }
                    
                    if(k === 13) { // Enter -> Tocar
                        playChannel();
                    }
                    updateFocus();
                }
            }
        });

        function playChannel() {
            let ch = STATE.chans[STATE.chanIdx];
            let vid = document.getElementById('player');
            let box = document.getElementById('v-box');
            let url = `${STATE.creds.h}/live/${STATE.creds.u}/${STATE.creds.p}/${ch.stream_id}.ts`;

            // Lógica 2 Cliques
            let isPlayingSame = (vid.src === url);

            if(isPlayingSame && !vid.paused) {
                // 2º Clique -> Fullscreen
                if(box.requestFullscreen) box.requestFullscreen();
                else if(vid.webkitRequestFullscreen) vid.webkitRequestFullscreen();
            } else {
                // 1º Clique -> Play Preview
                document.getElementById('lbl-now').innerText = ch.name;
                document.querySelectorAll('.item-chan').forEach(x => x.classList.remove('playing'));
                document.getElementById(`chan-${STATE.chanIdx}`).classList.add('playing');
                box.classList.add('highlight');

                vid.src = url;
                vid.play();
            }
        }
    </script>
</body>
</html>
