<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STB SMART UP PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILO STB GOLD LEVE --- */
        :root { 
            --bg: #000000; 
            --gold: #FFD700; 
            --gold-dim: #b8860b;
            --focus: #FFD700;
            --panel: #101010;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg); color: #fff;
            font-family: 'Montserrat', sans-serif;
            width: 100vw; height: 100vh; overflow: hidden;
        }

        /* UTILITÁRIOS */
        .hide { display: none !important; }
        .flex { display: flex !important; }
        
        /* HEADER */
        .header {
            height: 10vh; display: flex; align-items: center; justify-content: space-between;
            padding: 0 4vw; background: linear-gradient(180deg, rgba(10,10,10,1) 0%, transparent);
            border-bottom: 1px solid #222;
        }
        .logo { font-size: 2.8vh; font-weight: 800; letter-spacing: 2px; }
        .logo span { color: var(--gold); }
        .clock { color: #888; font-size: 2vh; }

        /* --- TELA LOGIN (STB STYLE) --- */
        #screen-login {
            height: 90vh; display: flex; align-items: center; justify-content: center;
            background: radial-gradient(circle, #1a1a1a 0%, #000000 90%);
        }
        .login-box {
            width: 40vw; background: rgba(20,20,20,0.95); padding: 4vh;
            border: 1px solid var(--gold-dim); border-radius: 8px; text-align: center;
        }
        .login-box h2 { color: var(--gold); margin-bottom: 3vh; }
        
        .inp-group { margin-bottom: 2vh; text-align: left; }
        .inp-group label { font-size: 1.2vh; color: #666; margin-left: 5px; }
        .ipt {
            width: 100%; padding: 1.5vh; background: #000; border: 1px solid #333; 
            color: #fff; border-radius: 4px; font-size: 1.8vh;
        }
        .ipt:focus { border-color: var(--gold); }
        
        .btn {
            width: 100%; padding: 2vh; background: var(--gold-dim); color: #000;
            font-weight: bold; border: none; border-radius: 4px; cursor: pointer; margin-top: 1vh;
        }

        /* --- DASHBOARD (MENU) --- */
        #screen-dash {
            height: 90vh; display: flex; align-items: center; justify-content: center; gap: 2vw;
        }
        .tile {
            width: 18vw; height: 30vh; background: #080808; border: 1px solid #222;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 10px; transition: transform 0.2s;
        }
        .tile i { font-size: 5vh; margin-bottom: 2vh; color: #555; }
        .tile span { font-size: 1.8vh; font-weight: 600; color: #888; }

        /* --- LISTAS (CATEGORIAS E CANAIS) --- */
        #screen-list { height: 90vh; display: flex; }
        
        .col-left { width: 30vw; height: 100%; background: #0a0a0a; border-right: 1px solid #222; overflow-y: auto; }
        .col-right { width: 70vw; height: 100%; background: #000; overflow-y: auto; padding: 2vh; }

        .item-list {
            padding: 1.5vh 2vh; border-bottom: 1px solid #151515; font-size: 1.6vh; color: #aaa;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        /* Header da coluna */
        .col-head { padding: 2vh; color: var(--gold); font-weight: bold; background: #111; border-bottom: 1px solid var(--gold); }

        /* --- PLAYER PURO --- */
        #screen-player {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 999;
        }
        video { width: 100%; height: 100%; }

        /* TOAST (Aviso na tela sem barra) */
        #osd-msg {
            position: absolute; top: 5vh; right: 5vh; 
            background: rgba(255, 215, 0, 0.9); color: #000; 
            padding: 1vh 3vh; border-radius: 50px; font-weight: 800; font-size: 2vh;
            display: none; z-index: 1000; box-shadow: 0 0 30px rgba(255,215,0,0.3);
        }

        /* --- FOCO --- */
        .focused {
            background: var(--gold) !important;
            color: #000 !important;
            border-color: var(--gold) !important;
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255,215,0,0.2);
            z-index: 10;
        }
        .focused i, .focused span { color: #000 !important; }
        .tile.focused { transform: scale(1.1); }

        /* RODAPÉ COLORIDO */
        .footer-keys {
            position: fixed; bottom: 0; width: 100%; height: 5vh; background: #050505;
            display: flex; align-items: center; justify-content: center; gap: 3vw; border-top: 1px solid #222;
        }
        .key { display: flex; align-items: center; gap: 0.5vw; font-size: 1.2vh; color: #666; }
        .dot { width: 1.2vh; height: 1.2vh; border-radius: 50%; }

        /* LOADING */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000;
        }
        .spin { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid var(--gold); border-radius: 50%; animation: s 1s infinite linear; }
        @keyframes s { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="osd-msg">PAUSE</div>

    <div id="loader" class="hide">
        <div class="spin"></div>
        <div style="margin-top:20px; color:var(--gold)" id="load-txt">CARREGANDO...</div>
    </div>

    <div class="header">
        <div class="logo">STB <span>UP</span></div>
        <div class="clock" id="clock">00:00</div>
    </div>

    <div id="screen-login">
        <div class="login-box">
            <h2>CONFIGURAÇÃO SERVIDOR</h2>
            <div class="inp-group">
                <label>DNS / URL (Ex: http://line.com:80)</label>
                <input type="text" id="host" class="ipt focusable" placeholder="http://...">
            </div>
            <div class="inp-group">
                <label>USUÁRIO</label>
                <input type="text" id="user" class="ipt focusable">
            </div>
            <div class="inp-group">
                <label>SENHA</label>
                <input type="password" id="pass" class="ipt focusable">
            </div>
            <button class="btn focusable" onclick="App.doLogin()">CONECTAR</button>
        </div>
    </div>

    <div id="screen-dash" class="hide">
        <div class="tile focusable" onclick="App.getCategories('live')">
            <i class="fas fa-tv"></i><span>TV AO VIVO</span>
        </div>
        <div class="tile focusable" onclick="App.getCategories('movie')">
            <i class="fas fa-film"></i><span>FILMES</span>
        </div>
        <div class="tile focusable" onclick="App.getCategories('series')">
            <i class="fas fa-video"></i><span>SÉRIES</span>
        </div>
        <div class="tile focusable" onclick="App.logout()">
            <i class="fas fa-sign-out-alt"></i><span>SAIR</span>
        </div>
    </div>

    <div id="screen-list" class="hide">
        <div class="col-left">
            <div class="col-head">CATEGORIAS</div>
            <div id="list-cats"></div>
        </div>
        <div class="col-right">
            <div class="col-head" id="title-items">CONTEÚDO</div>
            <div id="list-items"></div>
        </div>
    </div>

    <div id="screen-player" class="hide">
        <video id="vid"></video>
    </div>

    <div class="footer-keys">
        <div class="key"><div class="dot" style="background:red"></div> SAIR/VOLTAR</div>
        <div class="key"><div class="dot" style="background:green"></div> ORDENAR</div>
        <div class="key"><div class="dot" style="background:yellow"></div> FAVORITOS</div>
        <div class="key"><div class="dot" style="background:blue"></div> TELA CHEIA</div>
    </div>

    <script>
        const App = {
            scr: 'login', // login, dash, list, player
            items: [],
            idx: 0,
            creds: {},
            type: '',
            hls: null,

            init: function() {
                // Relógio
                setInterval(() => {
                    const d = new Date();
                    document.getElementById('clock').innerText = d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
                }, 1000);

                // Recuperar Login
                const s = localStorage.getItem('stb_data');
                if(s) {
                    this.creds = JSON.parse(s);
                    document.getElementById('host').value = this.creds.host;
                    document.getElementById('user').value = this.creds.user;
                    document.getElementById('pass').value = this.creds.pass;
                    // Auto Focus no botão Conectar
                    setTimeout(() => {
                        this.scan('#screen-login .focusable');
                        this.idx = 3; this.focus();
                    }, 500);
                } else {
                    this.scan('#screen-login .focusable');
                }

                // Teclado
                document.addEventListener('keydown', (e) => this.key(e));
            },

            // --- SISTEMA DE FOCO ---
            scan: function(selector) {
                this.items = document.querySelectorAll(selector);
                this.idx = 0;
                this.focus();
            },
            
            focus: function() {
                document.querySelectorAll('.focused').forEach(e => e.classList.remove('focused'));
                if(this.items[this.idx]) {
                    const el = this.items[this.idx];
                    el.classList.add('focused');
                    el.scrollIntoView({block:'center', behavior:'smooth'});
                    if(el.tagName === 'INPUT') el.focus();
                }
            },

            // --- CONTROLE REMOTO ---
            key: function(e) {
                const k = e.keyCode;

                // PLAYER KEYS (Prioridade)
                if(this.scr === 'player') {
                    e.preventDefault();
                    const v = document.getElementById('vid');
                    
                    if(k===13 || k===19) { // Enter/Pause
                        v.paused ? (v.play(), this.osd("PLAY ▶")) : (v.pause(), this.osd("PAUSE ⏸"));
                    }
                    else if(k===39) { v.currentTime += 15; this.osd(">> 15s"); } // Dir
                    else if(k===37) { v.currentTime -= 15; this.osd("<< 15s"); } // Esq
                    else if(k===403 || k===8 || k===461 || k===10009 || k===27) { this.stop(); } // Voltar/Red
                    else if(k===406) { // Azul (Zoom)
                        v.style.objectFit = v.style.objectFit==='cover' ? 'contain' : 'cover';
                        this.osd(v.style.objectFit==='cover' ? "ZOOM: CHEIO" : "ZOOM: NORMAL");
                    }
                    return;
                }

                // TECLAS GERAIS
                if(k===403 || k===8 || k===461 || k===10009) { // Red/Back
                    this.back(); return;
                }

                if(k===38) { // Cima
                    this.idx--; if(this.idx < 0) this.idx = 0;
                    this.focus();
                }
                else if(k===40) { // Baixo
                    this.idx++; if(this.idx >= this.items.length) this.idx = this.items.length-1;
                    this.focus();
                }
                else if(k===37) { // Esquerda
                    if(this.scr==='list' && document.activeElement.closest('.col-right')) {
                        this.scan('#list-cats .item-list'); // Volta para coluna esquerda
                    }
                }
                else if(k===39) { // Direita
                    if(this.scr==='list' && document.activeElement.closest('.col-left')) {
                        // Se tiver itens na direita, vai pra lá
                        if(document.querySelector('#list-items .item-list')) {
                            this.scan('#list-items .item-list');
                        }
                    }
                }
                else if(k===13) { // Enter
                    if(this.items[this.idx].tagName === 'INPUT') {
                         // Fecha teclado se possível e foca proximo
                         this.items[this.idx].blur();
                         if(this.items[this.idx].id === 'pass') this.doLogin();
                    } else {
                        this.items[this.idx].click();
                    }
                }
            },

            // --- LÓGICA ---
            doLogin: function() {
                const h = document.getElementById('host').value.replace(/\/$/, "");
                const u = document.getElementById('user').value;
                const p = document.getElementById('pass').value;

                if(!h || !u || !p) { alert("Preencha tudo!"); return; }

                this.loading(true);
                // Testa login
                fetch(`${h}/player_api.php?username=${u}&password=${p}&action=get_live_categories`)
                .then(r => r.json())
                .then(d => {
                    localStorage.setItem('stb_data', JSON.stringify({host:h, user:u, pass:p}));
                    this.creds = {host:h, user:u, pass:p};
                    this.nav('dash');
                    this.loading(false);
                })
                .catch(e => {
                    this.loading(false);
                    alert("Erro de conexão. Verifique DNS.");
                });
            },

            getCategories: function(type) {
                this.type = type;
                this.loading(true);
                let action = type==='live' ? 'get_live_categories' : (type==='movie' ? 'get_vod_categories' : 'get_series_categories');

                fetch(`${this.creds.host}/player_api.php?username=${this.creds.user}&password=${this.creds.pass}&action=${action}`)
                .then(r => r.json())
                .then(d => {
                    const el = document.getElementById('list-cats');
                    el.innerHTML = '';
                    d.forEach(c => {
                        const div = document.createElement('div');
                        div.className = 'item-list focusable';
                        div.innerText = c.category_name;
                        div.onclick = () => {
                            // Marca visual
                            document.querySelectorAll('#list-cats .item-list').forEach(x => x.style.color = '#aaa');
                            div.style.color = 'var(--gold)';
                            this.getStreams(c.category_id);
                        };
                        el.appendChild(div);
                    });
                    
                    document.getElementById('list-items').innerHTML = '<div style="color:#444; padding:20px">Selecione uma Categoria</div>';
                    this.nav('list');
                    this.loading(false);
                    this.scan('#list-cats .item-list');
                })
                .catch(e => { this.loading(false); alert("Erro ao baixar categorias"); });
            },

            getStreams: function(catId) {
                this.loading(true);
                let action = '';
                if(this.type === 'live') action = `get_live_streams&category_id=${catId}`;
                if(this.type === 'movie') action = `get_vod_streams&category_id=${catId}`;
                if(this.type === 'series') action = `get_series&category_id=${catId}`;

                fetch(`${this.creds.host}/player_api.php?username=${this.creds.user}&password=${this.creds.pass}&action=${action}`)
                .then(r => r.json())
                .then(d => {
                    const el = document.getElementById('list-items');
                    el.innerHTML = '';
                    d.forEach(i => {
                        const div = document.createElement('div');
                        div.className = 'item-list focusable';
                        div.innerText = i.name;
                        div.onclick = () => this.play(i);
                        el.appendChild(div);
                    });
                    this.loading(false);
                    // Pula o foco para a direita automaticamente
                    this.scan('#list-items .item-list');
                });
            },

            play: function(item) {
                const v = document.getElementById('vid');
                let url = '';
                let ext = item.container_extension || 'mp4'; // Padrão vod

                if(this.type === 'live') {
                    url = `${this.creds.host}/live/${this.creds.user}/${this.creds.pass}/${item.stream_id}.m3u8`;
                } else {
                    url = `${this.creds.host}/movie/${this.creds.user}/${this.creds.pass}/${item.stream_id}.${ext}`;
                }

                document.getElementById('screen-player').classList.remove('hide');
                this.scr = 'player';

                if(Hls.isSupported() && url.includes('.m3u8')) {
                    if(this.hls) this.hls.destroy();
                    this.hls = new Hls();
                    this.hls.loadSource(url);
                    this.hls.attachMedia(v);
                    this.hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
                } else {
                    v.src = url;
                    v.play();
                }
            },

            stop: function() {
                const v = document.getElementById('vid');
                v.pause(); v.src = "";
                document.getElementById('screen-player').classList.add('hide');
                this.scr = 'list';
                this.scan('#list-items .item-list');
            },

            // --- NAVEGAÇÃO UI ---
            nav: function(s) {
                ['screen-login','screen-dash','screen-list'].forEach(id => document.getElementById(id).classList.add('hide'));
                document.getElementById('screen-'+s).classList.remove('hide');
                this.scr = s;
            },

            back: function() {
                if(this.scr === 'list') {
                    this.nav('dash'); this.scan('#screen-dash .focusable');
                } else if(this.scr === 'dash') {
                    if(confirm("Deslogar?")) {
                        localStorage.removeItem('stb_data');
                        location.reload();
                    }
                }
            },

            logout: function() {
                 localStorage.removeItem('stb_data');
                 location.reload();
            },

            loading: function(show) {
                document.getElementById('loader').classList.toggle('hide', !show);
            },

            osd: function(msg) {
                const o = document.getElementById('osd-msg');
                o.innerText = msg;
                o.style.display = 'block';
                setTimeout(() => o.style.display = 'none', 2000);
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
